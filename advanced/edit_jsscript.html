<!doctype html>
<html lang="zh-cn" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://localhost:8080/sealdice-manual-next/advanced/edit_jsscript.html"><meta property="og:site_name" content="海豹手册"><meta property="og:title" content="编写 JavaScript 插件"><meta property="og:description" content="本节内容 本节将介绍 JavaScript 脚本的编写，请善用侧边栏和搜索，按需阅读文档。 我们假定你熟悉 JavaScript / TypeScript，编程语言的教学超出了本文档的目的，如果你还不熟悉它们，可以从互联网上寻找到很多优秀的教程。如： 现代 JavaScript 教程 (https://zh.javascript.info); Java..."><meta property="og:type" content="article"><meta property="og:image" content="http://localhost:8080/sealdice-manual-next/"><meta property="og:locale" content="zh-cn"><meta property="og:updated_time" content="2024-01-31T08:04:58.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="编写 JavaScript 插件"><meta property="article:author" content="SealDice Team"><meta property="article:modified_time" content="2024-01-31T08:04:58.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"编写 JavaScript 插件","image":["http://localhost:8080/sealdice-manual-next/"],"dateModified":"2024-01-31T08:04:58.000Z","author":[{"@type":"Person","name":"SealDice Team","url":"https://github.com/sealdice"}]}</script><link rel="icon" href="/sealdice-manual-next/images/sealdice.svg"><title>编写 JavaScript 插件 | 海豹手册</title><meta name="description" content="本节内容 本节将介绍 JavaScript 脚本的编写，请善用侧边栏和搜索，按需阅读文档。 我们假定你熟悉 JavaScript / TypeScript，编程语言的教学超出了本文档的目的，如果你还不熟悉它们，可以从互联网上寻找到很多优秀的教程。如： 现代 JavaScript 教程 (https://zh.javascript.info); Java...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/sealdice-manual-next/assets/style-677de30b.css" as="style"><link rel="stylesheet" href="/sealdice-manual-next/assets/style-677de30b.css">
    <link rel="modulepreload" href="/sealdice-manual-next/assets/app-8df52869.js"><link rel="modulepreload" href="/sealdice-manual-next/assets/edit_jsscript.html-a4e78709.js"><link rel="modulepreload" href="/sealdice-manual-next/assets/edit_jsscript.html-da137148.js"><link rel="modulepreload" href="/sealdice-manual-next/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-73618f13.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-504e4869.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/about.html-7d984a3d.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/develop.html-8368e524.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/license.html-0d1d1ea1.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-be456750.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_complex_custom_text.html-1d61e1f5.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_deck.html-0561bd24.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_gamesystem.html-ea8f8960.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_helpdoc.html-2acfae3a.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_reply.html-f68dd924.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_sensitive_words.html-0af33e8e.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/introduce.html-ed378809.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/script.html-0c9ac02a.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-a2823f62.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/ban.html-67c8006e.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/censor.html-cd0a1880.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/custom_text.html-ed9e015b.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/deck.html-4b2e188f.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/helpdoc.html-49538686.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/jsscript.html-102df8cf.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/quit_grp_auto.html-e780bb51.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/reply.html-0e7064a1.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-554d7cf3.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/db-repair.html-13b76aa6.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-dingtalk.html-3e2fd937.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-discord.html-84904ba9.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-dodo.html-aff38047.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-kook.html-8d1947c2.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-qq.html-bfb24779.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-slack.html-7b5fc069.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-telegram.html-561dd7ef.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/quick-start.html-bca29eda.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/special_feature.html-cf0198d3.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/transfer.html-08432ef9.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-0cb69b9c.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/attribute_alias.html-da518306.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/coc7.html-99eede96.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/core.html-84ceeb45.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/deck_and_reply.html-d639fb4e.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/dnd5e.html-96eac31b.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/faq.html-a55bc751.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/fun.html-ca1af4dc.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/introduce.html-518285ef.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/log.html-628e05b0.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/other_rules.html-19513dfa.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/quick-start.html-4a107c5f.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/story.html-548decfc.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/404.html-9cff2bf5.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-5936b976.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-6b92c82d.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/about.html-cb434b76.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/develop.html-38101998.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/license.html-40d16d54.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-a8e69400.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_complex_custom_text.html-1db4b5f4.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_deck.html-fa3d5f7b.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_gamesystem.html-f20f7c39.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_helpdoc.html-9e556589.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_reply.html-e38ded10.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/edit_sensitive_words.html-713620f0.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/introduce.html-5b0c9204.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/script.html-ab480577.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-31508ee9.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/ban.html-39dc95bf.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/censor.html-0a15e2ab.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/custom_text.html-9925d77f.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/deck.html-de5b05f2.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/helpdoc.html-4b5cd6e2.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/jsscript.html-f9bc1a8b.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/quit_grp_auto.html-dbffc8b6.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/reply.html-00065630.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-e3fc0132.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/db-repair.html-aa4d8d14.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-dingtalk.html-d74dc4c0.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-discord.html-83638ad7.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-dodo.html-b1b9d0ae.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-kook.html-96864a0f.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-qq.html-3fb8685c.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-slack.html-1fc301bf.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/platform-telegram.html-2a0dd1f1.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/quick-start.html-deca03b6.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/special_feature.html-be5abf86.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/transfer.html-a867eb3b.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/index.html-7e85fccb.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/attribute_alias.html-ff434b4b.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/coc7.html-0559f20b.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/core.html-14d0593c.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/deck_and_reply.html-a4044dc3.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/dnd5e.html-c4f46029.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/faq.html-8f6d1965.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/fun.html-b3418cb5.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/introduce.html-ff5ba593.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/log.html-8dfe5afe.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/other_rules.html-e29a479f.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/quick-start.html-6af08b81.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/story.html-ee77b24f.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/404.html-3c4de37e.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/photoswipe.esm-1464cdb9.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/ChatBox-a6ce8ffc.js" as="script"><link rel="prefetch" href="/sealdice-manual-next/assets/SearchResult-ddbabf56.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/sealdice-manual-next/"><img class="vp-nav-logo light" src="/sealdice-manual-next/images/sealdice.svg" alt="海豹手册"><img class="vp-nav-logo dark" src="/sealdice-manual-next/images/sealdice-dark.svg" alt="海豹手册"><span class="vp-site-name hide-in-pad">海豹手册</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="首页" class="vp-link nav-link nav-link" href="/sealdice-manual-next/"><!---->首页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="部署"><span class="title"><!---->部署</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-label="快速开始" class="vp-link nav-link nav-link" href="/sealdice-manual-next/deploy/quick-start.html"><!---->快速开始<!----></a></li><li class="dropdown-item"><a aria-label="迁移" class="vp-link nav-link nav-link" href="/sealdice-manual-next/deploy/transfer.html"><!---->迁移<!----></a></li><li class="dropdown-item"><a aria-label="特色功能" class="vp-link nav-link nav-link" href="/sealdice-manual-next/deploy/special_feature.html"><!---->特色功能<!----></a></li><li class="dropdown-item"><a aria-label="数据库检查和修复" class="vp-link nav-link nav-link" href="/sealdice-manual-next/deploy/db-repair.html"><!---->数据库检查和修复<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>平台</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="QQ" class="vp-link nav-link nav-link" href="/sealdice-manual-next/deploy/platform-qq.html"><!---->QQ<!----></a></li><li class="dropdown-subitem"><a aria-label="KOOK" class="vp-link nav-link nav-link" href="/sealdice-manual-next/deploy/platform-kook.html"><!---->KOOK<!----></a></li><li class="dropdown-subitem"><a aria-label="DoDo" class="vp-link nav-link nav-link" href="/sealdice-manual-next/deploy/platform-dodo.html"><!---->DoDo<!----></a></li><li class="dropdown-subitem"><a aria-label="Discord" class="vp-link nav-link nav-link" href="/sealdice-manual-next/deploy/platform-discord.html"><!---->Discord<!----></a></li><li class="dropdown-subitem"><a aria-label="Telegram" class="vp-link nav-link nav-link" href="/sealdice-manual-next/deploy/platform-telegram.html"><!---->Telegram<!----></a></li><li class="dropdown-subitem"><a aria-label="Slack" class="vp-link nav-link nav-link" href="/sealdice-manual-next/deploy/platform-slack.html"><!---->Slack<!----></a></li><li class="dropdown-subitem"><a aria-label="钉钉" class="vp-link nav-link nav-link" href="/sealdice-manual-next/deploy/platform-dingtalk.html"><!---->钉钉<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="配置"><span class="title"><!---->配置</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>扩展功能</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="自定义文案" class="vp-link nav-link nav-link" href="/sealdice-manual-next/config/custom_text.html"><!---->自定义文案<!----></a></li><li class="dropdown-subitem"><a aria-label="自定义回复" class="vp-link nav-link nav-link" href="/sealdice-manual-next/config/reply.html"><!---->自定义回复<!----></a></li><li class="dropdown-subitem"><a aria-label="牌堆" class="vp-link nav-link nav-link" href="/sealdice-manual-next/config/deck.html"><!---->牌堆<!----></a></li><li class="dropdown-subitem"><a aria-label="JavaScript 插件" class="vp-link nav-link nav-link" href="/sealdice-manual-next/config/jsscript.html"><!---->JavaScript 插件<!----></a></li><li class="dropdown-subitem"><a aria-label="帮助文档" class="vp-link nav-link nav-link" href="/sealdice-manual-next/config/helpdoc.html"><!---->帮助文档<!----></a></li><li class="dropdown-subitem"><a aria-label="拦截" class="vp-link nav-link nav-link" href="/sealdice-manual-next/config/censor.html"><!---->拦截<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>综合设置</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="黑白名单" class="vp-link nav-link nav-link" href="/sealdice-manual-next/config/ban.html"><!---->黑白名单<!----></a></li><li class="dropdown-subitem"><a aria-label="自动退出不活跃群组" class="vp-link nav-link nav-link" href="/sealdice-manual-next/config/quit_grp_auto.html"><!---->自动退出不活跃群组<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="使用"><span class="title"><!---->使用</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>新手入门</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="基础概念" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/introduce.html"><!---->基础概念<!----></a></li><li class="dropdown-subitem"><a aria-label="快速上手" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/quick-start.html"><!---->快速上手<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>核心指令</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="核心指令" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/core.html"><!---->核心指令<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>规则扩展</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="克苏鲁的呼唤 7 版" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/coc7.html"><!---->克苏鲁的呼唤 7 版<!----></a></li><li class="dropdown-subitem"><a aria-label="龙与地下城 5E" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/dnd5e.html"><!---->龙与地下城 5E<!----></a></li><li class="dropdown-subitem"><a aria-label="属性同义词" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/attribute_alias.html"><!---->属性同义词<!----></a></li><li class="dropdown-subitem"><a aria-label="其它规则支持" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/other_rules.html"><!---->其它规则支持<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>功能扩展</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="故事" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/story.html"><!---->故事<!----></a></li><li class="dropdown-subitem"><a aria-label="日志" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/log.html"><!---->日志<!----></a></li><li class="dropdown-subitem"><a aria-label="娱乐" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/fun.html"><!---->娱乐<!----></a></li><li class="dropdown-subitem"><a aria-label="牌堆 自定义回复" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/deck_and_reply.html"><!---->牌堆 自定义回复<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>常见问题</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="常见问题" class="vp-link nav-link nav-link" href="/sealdice-manual-next/use/faq.html"><!---->常见问题<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="进阶"><span class="title"><!---->进阶</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-label="进阶介绍" class="vp-link nav-link nav-link" href="/sealdice-manual-next/advanced/introduce.html"><!---->进阶介绍<!----></a></li><li class="dropdown-item"><a aria-label="内置脚本语言" class="vp-link nav-link nav-link" href="/sealdice-manual-next/advanced/script.html"><!---->内置脚本语言<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>扩展功能进阶</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="编写复杂文案" class="vp-link nav-link nav-link" href="/sealdice-manual-next/advanced/edit_complex_custom_text.html"><!---->编写复杂文案<!----></a></li><li class="dropdown-subitem"><a aria-label="编写自定义回复" class="vp-link nav-link nav-link" href="/sealdice-manual-next/advanced/edit_reply.html"><!---->编写自定义回复<!----></a></li><li class="dropdown-subitem"><a aria-label="编写牌堆" class="vp-link nav-link nav-link" href="/sealdice-manual-next/advanced/edit_deck.html"><!---->编写牌堆<!----></a></li><li class="dropdown-subitem"><a aria-label="编写 JavaScript 插件" class="vp-link nav-link active nav-link active" href="/sealdice-manual-next/advanced/edit_jsscript.html"><!---->编写 JavaScript 插件<!----></a></li><li class="dropdown-subitem"><a aria-label="编写新的 TRPG 规则" class="vp-link nav-link nav-link" href="/sealdice-manual-next/advanced/edit_gamesystem.html"><!---->编写新的 TRPG 规则<!----></a></li><li class="dropdown-subitem"><a aria-label="编写帮助文档" class="vp-link nav-link nav-link" href="/sealdice-manual-next/advanced/edit_helpdoc.html"><!---->编写帮助文档<!----></a></li><li class="dropdown-subitem"><a aria-label="编写敏感词库" class="vp-link nav-link nav-link" href="/sealdice-manual-next/advanced/edit_sensitive_words.html"><!---->编写敏感词库<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="关于"><span class="title"><!---->关于</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-label="关于" class="vp-link nav-link nav-link" href="/sealdice-manual-next/about/about.html"><!---->关于<!----></a></li><li class="dropdown-item"><a aria-label="许可协议" class="vp-link nav-link nav-link" href="/sealdice-manual-next/about/license.html"><!---->许可协议<!----></a></li><li class="dropdown-item"><a aria-label="参与项目" class="vp-link nav-link nav-link" href="/sealdice-manual-next/about/develop.html"><!---->参与项目<!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/sealdice/sealdice-core" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading clickable active"><!----><a aria-label="进阶" class="vp-link nav-link active vp-sidebar-title nav-link active vp-sidebar-title" href="/sealdice-manual-next/advanced/"><!---->进阶<!----></a><!----></p><ul class="vp-sidebar-links"><li><!--[--><a aria-label="进阶介绍" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/sealdice-manual-next/advanced/introduce.html"><!---->进阶介绍<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="内置脚本语言" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/sealdice-manual-next/advanced/script.html"><!---->内置脚本语言<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading active"><!----><span class="vp-sidebar-title">扩展功能进阶</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a aria-label="编写复杂文案" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/sealdice-manual-next/advanced/edit_complex_custom_text.html"><!---->编写复杂文案<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="编写自定义回复" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/sealdice-manual-next/advanced/edit_reply.html"><!---->编写自定义回复<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="编写牌堆" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/sealdice-manual-next/advanced/edit_deck.html"><!---->编写牌堆<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="编写 JavaScript 插件" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/sealdice-manual-next/advanced/edit_jsscript.html"><!---->编写 JavaScript 插件<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="一些有帮助的资源" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#一些有帮助的资源"><!---->一些有帮助的资源<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="第一个 JS 扩展" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#第一个-js-扩展"><!---->第一个 JS 扩展<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="填写插件信息" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#填写插件信息"><!---->填写插件信息<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="创建和注册扩展" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#创建和注册扩展"><!---->创建和注册扩展<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="自定义指令" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#自定义指令"><!---->自定义指令<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="创建指令" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#创建指令"><!---->创建指令<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="指令参数与返回值" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#指令参数与返回值"><!---->指令参数与返回值<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="指令核心执行流程" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#指令核心执行流程"><!---->指令核心执行流程<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="注册指令" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#注册指令"><!---->注册指令<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="生成随机数" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#生成随机数"><!---->生成随机数<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="抽取牌堆" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#抽取牌堆"><!---->抽取牌堆<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="示例代码：抽取牌堆" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#示例代码-抽取牌堆"><!---->示例代码：抽取牌堆<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="权限识别" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#权限识别"><!---->权限识别<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="示例代码：权限识别" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#示例代码-权限识别"><!---->示例代码：权限识别<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="黑名单 / 信任名单操作" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#黑名单-信任名单操作"><!---->黑名单 / 信任名单操作<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="黑名单操作的函数" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#黑名单操作的函数"><!---->黑名单操作的函数<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="信任用户名单" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#信任用户名单"><!---->信任用户名单<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="获取黑名单 / 信任名单列表" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#获取黑名单-信任名单列表"><!---->获取黑名单 / 信任名单列表<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="获取用户在黑名单 / 信任名单中的信息" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#获取用户在黑名单-信任名单中的信息"><!---->获取用户在黑名单 / 信任名单中的信息<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="示例代码：黑名单 / 信任名单操作" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#示例代码-黑名单-信任名单操作"><!---->示例代码：黑名单 / 信任名单操作<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="存取数据" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#存取数据"><!---->存取数据<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="示例代码：投喂插件" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#示例代码-投喂插件"><!---->示例代码：投喂插件<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="示例代码：群内安价收集" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#示例代码-群内安价收集"><!---->示例代码：群内安价收集<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="数据处理模板" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#数据处理模板"><!---->数据处理模板<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="读取玩家或群组数据" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#读取玩家或群组数据"><!---->读取玩家或群组数据<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="编写暗骰指令" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#编写暗骰指令"><!---->编写暗骰指令<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="编写代骰指令" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#编写代骰指令"><!---->编写代骰指令<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="网络请求" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#网络请求"><!---->网络请求<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="自定义 COC 规则" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#自定义-coc-规则"><!---->自定义 COC 规则<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="补充：使用非指令关键词" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#补充-使用非指令关键词"><!---->补充：使用非指令关键词<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="注册插件配置项" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#注册插件配置项"><!---->注册插件配置项<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="示例代码：注册配置项" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#示例代码-注册配置项"><!---->示例代码：注册配置项<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="使用 TS 模板" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#使用-ts-模板"><!---->使用 TS 模板<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="clone 或下载项目" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#clone-或下载项目"><!---->clone 或下载项目<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="使用和编译" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#使用和编译"><!---->使用和编译<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="补全信息" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#补全信息"><!---->补全信息<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="目录结构" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#目录结构"><!---->目录结构<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="JS 扩展 API" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#js-扩展-api"><!---->JS 扩展 API<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="部分 api 使用示例" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#部分-api-使用示例"><!---->部分 api 使用示例<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="ctx 的内容" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#ctx-的内容"><!---->ctx 的内容<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="msg 的内容" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#msg-的内容"><!---->msg 的内容<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="cmdArgs 的内容" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/sealdice-manual-next/advanced/edit_jsscript.html#cmdargs-的内容"><!---->cmdArgs 的内容<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a aria-label="编写新的 TRPG 规则" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/sealdice-manual-next/advanced/edit_gamesystem.html"><!---->编写新的 TRPG 规则<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="编写帮助文档" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/sealdice-manual-next/advanced/edit_helpdoc.html"><!---->编写帮助文档<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="编写敏感词库" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/sealdice-manual-next/advanced/edit_sensitive_words.html"><!---->编写敏感词库<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->编写 JavaScript 插件</h1><div class="page-info"><span class="page-reading-time-info" aria-label="阅读时间"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 38 分钟</span><meta property="timeRequired" content="PT38M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<!----></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#一些有帮助的资源">一些有帮助的资源</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#第一个-js-扩展">第一个 JS 扩展</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#填写插件信息">填写插件信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#创建和注册扩展">创建和注册扩展</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#自定义指令">自定义指令</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#创建指令">创建指令</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#指令参数与返回值">指令参数与返回值</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#指令核心执行流程">指令核心执行流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#注册指令">注册指令</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#生成随机数">生成随机数</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#抽取牌堆">抽取牌堆</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#示例代码-抽取牌堆">示例代码：抽取牌堆</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#权限识别">权限识别</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#示例代码-权限识别">示例代码：权限识别</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#黑名单-信任名单操作">黑名单 / 信任名单操作</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#黑名单操作的函数">黑名单操作的函数</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#信任用户名单">信任用户名单</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#获取黑名单-信任名单列表">获取黑名单 / 信任名单列表</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#获取用户在黑名单-信任名单中的信息">获取用户在黑名单 / 信任名单中的信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#示例代码-黑名单-信任名单操作">示例代码：黑名单 / 信任名单操作</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#存取数据">存取数据</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#示例代码-投喂插件">示例代码：投喂插件</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#示例代码-群内安价收集">示例代码：群内安价收集</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#数据处理模板">数据处理模板</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#读取玩家或群组数据">读取玩家或群组数据</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#编写暗骰指令">编写暗骰指令</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#编写代骰指令">编写代骰指令</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#网络请求">网络请求</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#自定义-coc-规则">自定义 COC 规则</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#补充-使用非指令关键词">补充：使用非指令关键词</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#注册插件配置项">注册插件配置项</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#示例代码-注册配置项">示例代码：注册配置项</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#使用-ts-模板">使用 TS 模板</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#clone-或下载项目">clone 或下载项目</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#使用和编译">使用和编译</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#补全信息">补全信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#目录结构">目录结构</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/sealdice-manual-next/#js-扩展-api">JS 扩展 API</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#部分-api-使用示例">部分 api 使用示例</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#ctx-的内容">ctx 的内容</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#msg-的内容">msg 的内容</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/sealdice-manual-next/#cmdargs-的内容">cmdArgs 的内容</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="编写-javascript-插件" tabindex="-1"><a class="header-anchor" href="#编写-javascript-插件" aria-hidden="true">#</a> 编写 JavaScript 插件</h1><div class="hint-container info"><p class="hint-container-title">本节内容</p><p>本节将介绍 JavaScript 脚本的编写，请善用侧边栏和搜索，按需阅读文档。</p><p>我们假定你熟悉 JavaScript / TypeScript，编程语言的教学超出了本文档的目的，如果你还不熟悉它们，可以从互联网上寻找到很多优秀的教程。如：</p><ul><li><a href="https://zh.javascript.info" target="_blank" rel="noopener noreferrer">现代 JavaScript 教程<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.liaoxuefeng.com/wiki/1022910821149312" target="_blank" rel="noopener noreferrer">JavaScript 教程 - 廖雪峰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.runoob.com/js/js-tutorial.html" target="_blank" rel="noopener noreferrer">JavaScript - 菜鸟教程<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></div><h2 id="一些有帮助的资源" tabindex="-1"><a class="header-anchor" href="#一些有帮助的资源" aria-hidden="true">#</a> 一些有帮助的资源</h2><p>VS Code 可以安装 <a href="https://marketplace.visualstudio.com/items?itemName=yxChangingSelf.sealdice-snippets" target="_blank" rel="noopener noreferrer">SealDice Snippets<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 插件，提供了一些常见代码片段，帮助快速生成模板代码。</p><p>如果你打算使用 TypeScript，海豹提供了相应的 <a href="https://github.com/sealdice/sealdice-js-ext-template" target="_blank" rel="noopener noreferrer">模板工程<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，注册扩展和指令的代码已经写好，可以直接编译出一个可直接装载的 JS 扩展文件。使用见 <a href="#%E4%BD%BF%E7%94%A8-ts-%E6%A8%A1%E6%9D%BF">使用 TS 模板</a>。</p><!-- - 扩展编写示例：https://github.com/sealdice/javascript/tree/main/examples --><div class="hint-container tip"><p class="hint-container-title">使用 TypeScript</p><p>我们更推荐使用 TypeScript 来编写插件，编译到 ES6 后使用即可。不过先从 JavaScript 开始也是没有任何问题的。</p></div><h2 id="第一个-js-扩展" tabindex="-1"><a class="header-anchor" href="#第一个-js-扩展" aria-hidden="true">#</a> 第一个 JS 扩展</h2><p>我们从最简单的扩展开始，这个扩展只会在日志中打印一条 <code>Hello World!</code>。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         示例：如何开始</span>
<span class="token comment">// @author       木落</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  这是一个演示脚本，并没有任何实际作用。</span>
<span class="token comment">// @timestamp    1671368035</span>
<span class="token comment">// 2022-12-18</span>
<span class="token comment">// @license      Apache-2</span>
<span class="token comment">// @homepageURL  https://github.com/sealdice/javascript</span>
<span class="token comment">// ==/UserScript==</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Hello World!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container note"><p class="hint-container-title">海豹对 JavaScript 的支持</p><p>海豹使用 <a href="https://github.com/dop251/goja" target="_blank" rel="noopener noreferrer">goja<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 作为 js 脚本引擎。goja 目前支持了 ES6 基本上全部的特性，包括 <code>async/await</code>，<code>promise</code> 和 <code>generator</code>。</p><p>需要注意引擎的整型为 32 位，请小心溢出问题。同时 <code>setTimeout</code> 和 <code>setInterval</code> 返回的句柄为一个空对象，而非数字类型。</p></div><div class="hint-container tip"><p class="hint-container-title">打印日志</p><p>console 打印出来的东西不仅会在控制台中出现，在日志中也会显示。</p><p>涉及网络请求或延迟执行的内容，有时候不会在控制台调试面板上显示出来，而在日志中能看到。</p></div><h2 id="填写插件信息" tabindex="-1"><a class="header-anchor" href="#填写插件信息" aria-hidden="true">#</a> 填写插件信息</h2><p>每个 JS 扩展需要在开头以固定格式注释的形式留下信息，以便使用和分享：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         脚本的名字</span>
<span class="token comment">// @author       木落</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  这是一个演示脚本，并没有任何实际作用。</span>
<span class="token comment">// @timestamp    1672066028</span>
<span class="token comment">// @license      Apache-2</span>
<span class="token comment">// @homepageURL  https://github.com/sealdice/javascript</span>
<span class="token comment">// ==/UserScript==</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>属性</th><th>含义</th></tr></thead><tbody><tr><td>@name</td><td>JS 扩展的名称，会展示在插件列表页面</td></tr><tr><td>@author</td><td>作者名</td></tr><tr><td>@version</td><td>版本号，可以自己定义，但建议遵循 <a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener noreferrer">语义版本控制（Semantic Versioning）<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td></tr><tr><td>@description</td><td>对扩展的功能的描述</td></tr><tr><td>@timestamp</td><td>最后更新时间，以秒为单位的 unix 时间戳，新版本支持了直接使用时间字符串，如 <code>2023-10-30</code>。</td></tr><tr><td>@license</td><td>开源协议，示例中的 Apache-2 是一个比较自由的协议，允许任意使用和分发（包括商用），当然你也可以使用其它协议（MIT GPL 等）</td></tr><tr><td>@homepageURL</td><td>你的扩展的主页链接，有 GitHub 仓库可以填仓库链接，没有则可以填海豹官方插件仓库</td></tr></tbody></table><h2 id="创建和注册扩展" tabindex="-1"><a class="header-anchor" href="#创建和注册扩展" aria-hidden="true">#</a> 创建和注册扩展</h2><div class="hint-container tip"><p class="hint-container-title">扩展机制</p><p>扩展机制可以看做是海豹的 mod 管理机制，可以模块化开关海豹的任意一部分，如常用的开启 dnd 扩展，关闭 coc 扩展，关闭自动回复等。</p><p>可以查看 <a href="/sealdice-manual-next/use/core.html#ext-%E6%89%A9%E5%B1%95%E7%AE%A1%E7%90%86" class="">.ext 命令</a> 来了解更多。</p></div><p>在海豹中，<strong>所有指令必须归属于某个扩展</strong>，而一个扩展可以包含多条指令。</p><p>JS 脚本中创建扩展的方式如下，在创建扩展后，<strong>还需要注册扩展</strong>，才能让扩展起效，不要漏掉哦！</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 如何建立一个扩展</span>

<span class="token comment">// 首先检查是否已经存在</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 不存在，那么建立扩展，名为 test，作者“木落”，版本 1.0.0</span>
  <span class="token keyword">const</span> ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;木落&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1.0.0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 注册扩展</span>
  seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">JS 脚本和扩展</p><p>在实现上，海豹允许你在一个 JS 脚本文件中注册多个扩展，但我们不建议这样做。一般来说，一个 JS 脚本文件只会注册一个扩展。</p></div><div class="hint-container warning"><p class="hint-container-title">修改内置功能？</p><p>出于对公平性的考虑，JS 脚本不能替换内置指令和内置扩展。</p></div><!-- TODO: 添加 1.4.1 新增的 插件配置项 相关说明 --><h2 id="自定义指令" tabindex="-1"><a class="header-anchor" href="#自定义指令" aria-hidden="true">#</a> 自定义指令</h2><p>想要创建一条自定义指令，首先需要创建一个扩展（<code>seal.ExtInfo</code>），写好自定义指令的实现逻辑之后，再注册到扩展中。</p><h3 id="创建指令" tabindex="-1"><a class="header-anchor" href="#创建指令" aria-hidden="true">#</a> 创建指令</h3><p>接上面的代码，假定目前已经注册好了一个名为 <code>test</code> 的扩展，现在要写一个名为 <code>seal</code> 的指令：</p><ul><li>这个命令的功能为，显示「抓到一只海豹」的文案； <ul><li>如果命令写 <code>.seal ABC</code>，那么文案中将海豹命名为「ABC」；</li><li>如果命令中没写名字，那么命名为默认值「氪豹」。</li></ul></li></ul><p>第一步，创建新的自定义指令，设置好名字和帮助信息。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> cmdSeal <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cmdSeal<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;seal&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 指令名字，可用中文</span>
cmdSeal<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;召唤一只海豹，可用 .seal &lt;名字&gt; 命名&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">命令的帮助信息</p><p>命令的帮助信息是在使用 <code>.help &lt;命令&gt;</code> 时会返回的帮助内容。</p><p>帮助信息<strong>不要</strong>以 <code>.</code> 开头，防止查看帮助时骰子的回复触发其他骰子。</p></div><p>第二步，编写指令的具体处理代码。</p><p>你需要编写指令对象的 <code>solve</code> 函数，在使用该指令的时候，海豹核心会调用你写的这个函数。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>cmdSeal<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里是你需要编写的内容</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>ctx</code></td><td>主要是和当前环境以及用户相关的内容，如当前发指令用户，当前群组信息等</td></tr><tr><td><code>msg</code></td><td>原始指令内容，如指令文本，发送平台，发送时间等</td></tr><tr><td><code>cmdArgs</code></td><td>指令信息，会将用户发的信息进行分段，方便快速取用</td></tr></tbody></table><p>这里仅说明需要用到的接口，详细可见 <a href="https://github.com/sealdice/javascript/tree/main/examples_ts" target="_blank" rel="noopener noreferrer">插件仓库<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <code>examp_ts</code> 下的 <code>seal.d.ts</code> 文件，里面包含了目前开放的接口的定义及其注释说明。</p><h3 id="指令参数与返回值" tabindex="-1"><a class="header-anchor" href="#指令参数与返回值" aria-hidden="true">#</a> 指令参数与返回值</h3><p>假设用户发送过来的消息是 <code>.seal A B C</code>，那么可以用 <code>cmdArgs.getArgN(1)</code> 获取到 <code>A</code>，<code>cmdArgs.getArgN(2)</code> 获取到 <code>B</code>，<code>cmdArgs.getArgN(3)</code> 获取到 <code>C</code>。</p><p>通常会对参数值进行判断，随后作出响应。</p><p>以下代码处理的是 <code>.seal help</code> 的情形：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>cmdSeal<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取第一个参数，例如 .seal A B C</span>
  <span class="token comment">// 这里 cmdArgs.getArgN(1) 的结果即是 A，传参为 2 的话结果是 B</span>
  <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;help&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 命令为 .seal help</span>
      <span class="token comment">// 创建一个结果对象，并将 showHelp 标记为 true，这会自动给用户发送帮助</span>
      <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 没有传入参数时的代码</span>
      <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">返回执行结果</p><p>在执行完自己的代码之后，需要返回指令结果对象，其参数是是否执行成功。</p></div><h3 id="指令核心执行流程" tabindex="-1"><a class="header-anchor" href="#指令核心执行流程" aria-hidden="true">#</a> 指令核心执行流程</h3><p>给消息发送者回应，需要使用 <code>seal.replyToSender()</code> 函数，前两个参数和 <code>solve()</code> 函数接收的参数一致，第三个参数是你要发送的文本。</p><p>发送的文本中，可以包含 <a href="/sealdice-manual-next/advanced/script.html#%E5%8F%98%E9%87%8F" class="">变量</a>（例如<code>{$t玩家}</code>），也可以包含 <a href="https://docs.go-cqhttp.org/cqcode" target="_blank" rel="noopener noreferrer">CQ 码<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，用来实现回复发送者、@发送者、发送图片、发送分享卡片等功能。</p><p>在这个例子中，我们需要获取作为海豹名字的参数，获取不到就使用默认值，随后向消息发送者发送回应。</p><p>在刚刚的位置填入核心代码，就可以完成了。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>cmdSeal<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取第一个参数，例如 .seal A B C</span>
  <span class="token comment">// 这里 cmdArgs.getArgN(1) 的结果即是 A，传参为 2 的话结果是 B</span>
  <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;help&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 命令为 .seal help</span>
      <span class="token comment">// 创建一个结果对象，并将 showHelp 标记为 true，这会自动给用户发送帮助</span>
      <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 命令为 .seal XXXX，取第一个参数为名字</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>val<span class="token punctuation">)</span> val <span class="token operator">=</span> <span class="token string">&#39;氪豹&#39;</span><span class="token punctuation">;</span>
      <span class="token comment">// 进行回复，如果是群聊发送那么在群里回复，私聊发送则在私聊回复 (听起来是废话文学，但详细区别见暗骰例子)</span>
      seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你抓到一只海豹！取名为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n它的逃跑意愿为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="注册指令" tabindex="-1"><a class="header-anchor" href="#注册指令" aria-hidden="true">#</a> 注册指令</h3><p>第三步，将命令注册到扩展中。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;seal&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdSeal<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果你想要给这个命令起一个别名，也就是增加一个触发词，可以这样写：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;seal&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdSeal<span class="token punctuation">;</span> <span class="token comment">// 注册 .seal 指令</span>
ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;海豹&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdSeal<span class="token punctuation">;</span> <span class="token comment">// 注册 .海豹 指令，等效于 .seal</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>完整的代码如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         示例：编写一条自定义指令</span>
<span class="token comment">// @author       木落</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  召唤一只海豹，可用.seal &lt;名字&gt; 命名</span>
<span class="token comment">// @timestamp    1671368035</span>
<span class="token comment">// 2022-12-18</span>
<span class="token comment">// @license      Apache-2</span>
<span class="token comment">// @homepageURL  https://github.com/sealdice/javascript</span>
<span class="token comment">// ==/UserScript==</span>

<span class="token comment">// 编写一条自定义指令</span>
<span class="token comment">// 先将扩展模块创建出来，如果已创建就直接使用</span>
<span class="token keyword">let</span> ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;木落&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1.0.0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建指令 .seal</span>
<span class="token comment">// 这个命令的功能为，显示「抓到一只海豹」的文案；</span>
<span class="token comment">// 如果命令写 .seal ABC，那么文案中将海豹命名为「ABC」；</span>
<span class="token comment">// 如果命令中没写名字，那么命名为默认值「氪豹」。</span>
<span class="token keyword">const</span> cmdSeal <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cmdSeal<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;seal&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 指令名字，可用中文</span>
cmdSeal<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;召唤一只海豹，可用 .seal &lt;名字&gt; 命名&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 主函数，指令解析器会将指令信息解析，并储存在几个参数中</span>
<span class="token comment">// ctx 主要是和当前环境以及用户相关的内容，如当前发指令用户，当前群组信息等</span>
<span class="token comment">// msg 为原生态的指令内容，如指令文本，发送平台，发送时间等</span>
<span class="token comment">// cmdArgs 为指令信息，会将用户发的信息进行分段，方便快速取用</span>
cmdSeal<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取第一个参数，例如 .seal A B C</span>
  <span class="token comment">// 这里 cmdArgs.getArgN(1) 的结果即是 A，传参为 2 的话结果是 B</span>
  <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;help&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 命令为 .seal help</span>
      <span class="token comment">// 创建一个结果对象，并将 showHelp 标记为 true，这会自动给用户发送帮助</span>
      <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 命令为 .seal XXXX，取第一个参数为名字</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>val<span class="token punctuation">)</span> val <span class="token operator">=</span> <span class="token string">&#39;氪豹&#39;</span><span class="token punctuation">;</span>
      <span class="token comment">// 进行回复，如果是群聊发送那么在群里回复，私聊发送则在私聊回复 (听起来是废话文学，但详细区别见暗骰例子)</span>
      seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你抓到一只海豹！取名为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n它的逃跑意愿为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 将命令注册到扩展中</span>
ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;seal&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdSeal<span class="token punctuation">;</span>

<span class="token comment">// 无实际意义，用于消除编译报错</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这就是最基本的模板了。</p><h2 id="生成随机数" tabindex="-1"><a class="header-anchor" href="#生成随机数" aria-hidden="true">#</a> 生成随机数</h2><p>可以使用以下函数生成随机整数：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * 生成随机整数
 * <span class="token keyword">@param</span> <span class="token parameter">min</span> 最小值
 * <span class="token keyword">@param</span> <span class="token parameter">max</span> 最大值
 * <span class="token keyword">@returns</span> 位于 [min,max] 区间的随机整数
 */</span>
<span class="token keyword">function</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> min<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="抽取牌堆" tabindex="-1"><a class="header-anchor" href="#抽取牌堆" aria-hidden="true">#</a> 抽取牌堆</h2><p>抽取牌堆的函数是 <code>seal.deck.draw(ctx, deckName, shufflePool)</code></p><ul><li><code>ctx</code>：<code>MsgContext</code> 类型，指令上下文，<code>solve()</code> 函数传进来的第一个参数</li><li><code>deckName</code>：牌堆名称，字符串类型，例如 <code>GRE单词</code></li><li><code>shufflePool</code>：是否放回抽取，布尔类型，<code>true</code> 为放回抽取，<code>false</code> 为不放回抽取</li></ul><p>返回值是一个 <code>map</code>，包含以下字段：</p><ul><li><code>exists</code>：布尔类型，是否抽取成功</li><li><code>result</code>：字符串类型，抽取结果</li><li><code>err</code>：字符串类型，抽取失败的原因</li></ul><h3 id="示例代码-抽取牌堆" tabindex="-1"><a class="header-anchor" href="#示例代码-抽取牌堆" aria-hidden="true">#</a> 示例代码：抽取牌堆</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         抽取牌堆示例</span>
<span class="token comment">// @author       SzzRain</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  用于演示如何抽取牌堆</span>
<span class="token comment">// @timestamp    1699077659</span>
<span class="token comment">// @license      MIT</span>
<span class="token comment">// @homepageURL  https://github.com/sealdice/javascript</span>
<span class="token comment">// ==/UserScript==</span>

<span class="token comment">// 本脚本用于演示如何抽取牌堆, 共有两种实现方式</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;draw-decks-example&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&#39;draw-decks-example&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;SzzRain&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1.0.0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 创建一个命令</span>
  <span class="token keyword">const</span> cmdDrawDecks <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cmdDrawDecks<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;dr&#39;</span><span class="token punctuation">;</span>
  cmdDrawDecks<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;使用 .dr &lt;牌堆名&gt; 来抽取牌堆&#39;</span><span class="token punctuation">;</span>
  cmdDrawDecks<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 抽取牌堆</span>
    <span class="token comment">// 参数1：ctx 参数2：牌堆名称 参数3：是否放回抽取</span>
    <span class="token comment">// 返回值：{exists: true, result: &#39;抽取结果&#39;, err: &#39;错误原因&#39;}</span>
    <span class="token keyword">const</span> decks <span class="token operator">=</span> seal<span class="token punctuation">.</span>deck<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 判断是否抽取成功</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>decks<span class="token punctuation">[</span><span class="token string">&#39;exists&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> decks<span class="token punctuation">[</span><span class="token string">&#39;result&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&#39;抽取牌堆失败，原因：&#39;</span> <span class="token operator">+</span> decks<span class="token punctuation">[</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 注册命令</span>
  ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;dr&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdDrawDecks<span class="token punctuation">;</span>

  <span class="token comment">// 创建一个命令</span>
  <span class="token keyword">const</span> cmdDrawDecks2 <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cmdDrawDecks2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;dr2&#39;</span><span class="token punctuation">;</span>
  cmdDrawDecks2<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;使用 .dr2 &lt;牌堆名&gt; 来抽取牌堆&#39;</span><span class="token punctuation">;</span>
  cmdDrawDecks2<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 抽取牌堆的另一种写法，使用 format 函数，由于经过了 rollvm 的处理，所以代码的执行效率会更慢</span>
    <span class="token comment">// 不过这种写法的返回值固定为字符串，省去了判断是否抽取成功的步骤</span>
    <span class="token comment">// 参数1：ctx 参数2：海豹语表达式，其中 #{DRAW-牌堆名称} 会被替换为抽取结果</span>
    <span class="token keyword">const</span> decks <span class="token operator">=</span> seal<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#{DRAW-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> decks<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 注册命令</span>
  ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;dr2&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdDrawDecks2<span class="token punctuation">;</span>

  <span class="token comment">// 注册扩展</span>
  seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="权限识别" tabindex="-1"><a class="header-anchor" href="#权限识别" aria-hidden="true">#</a> 权限识别</h2><p>海豹中的权限等级，由高到低分别是：<strong>骰主</strong>，<strong>群主</strong>，<strong>管理员</strong>，<strong>邀请者</strong>，<strong>普通用户</strong> 和 <strong>黑名单用户</strong>。 每一个身份都有一个对应的数字，可以通过 <code>ctx.privilegeLevel</code> 获取当前用户的权限等级。 每个身份所对应的数字如下表所示：</p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p><strong>注意：</strong> 部分权限等级仅在群聊中有效，私聊中除了 <strong>骰主</strong> 和 <strong>黑名单用户</strong> 以外的权限等级都为 0。</p></div><table><thead><tr><th>身份</th><th>权限值</th></tr></thead><tbody><tr><td>骰主</td><td>100</td></tr><tr><td>群主</td><td>60</td></tr><tr><td>管理员</td><td>50</td></tr><tr><td>邀请者</td><td>40</td></tr><tr><td>普通用户</td><td>0</td></tr><tr><td>黑名单用户</td><td>-30</td></tr></tbody></table><div class="hint-container tip"><p class="hint-container-title">关于黑名单用户</p><p>通常情况下你不需要考虑黑名单用户的情况，因为黑名单用户的消息会被过滤掉，不会触发任何指令。</p></div><h3 id="示例代码-权限识别" tabindex="-1"><a class="header-anchor" href="#示例代码-权限识别" aria-hidden="true">#</a> 示例代码：权限识别</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         权限识别样例</span>
<span class="token comment">// @author       SzzRain</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  使用命令 .myperm 查看自己的权限</span>
<span class="token comment">// @timestamp    1699086084</span>
<span class="token comment">// @license      MIT</span>
<span class="token comment">// @homepageURL  https://github.com/Szzrain</span>
<span class="token comment">// ==/UserScript==</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;myperm&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&#39;myperm&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;SzzRain&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1.0.0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 创建一个命令</span>
  <span class="token keyword">const</span> cmdMyperm <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cmdMyperm<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;myperm&#39;</span><span class="token punctuation">;</span>
  cmdMyperm<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;使用 .myperm 展示我的权限&#39;</span><span class="token punctuation">;</span>
  cmdMyperm<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">&quot;普通用户&quot;</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>privilegeLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>privilegeLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">100</span><span class="token operator">:</span>
        text <span class="token operator">=</span> <span class="token string">&quot;master&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">60</span><span class="token operator">:</span>
        text <span class="token operator">=</span> <span class="token string">&quot;owner&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">50</span><span class="token operator">:</span>
        text <span class="token operator">=</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">40</span><span class="token operator">:</span>
        text <span class="token operator">=</span> <span class="token string">&quot;inviter&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">30</span><span class="token operator">:</span>
        <span class="token comment">// 黑名单用户，但是由于黑名单会被过滤掉，所以实际上这里并不会执行，这里只是为了演示</span>
        <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 注册命令</span>
  ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;myperm&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdMyperm<span class="token punctuation">;</span>

  <span class="token comment">// 注册扩展</span>
  seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="黑名单-信任名单操作" tabindex="-1"><a class="header-anchor" href="#黑名单-信任名单操作" aria-hidden="true">#</a> 黑名单 / 信任名单操作 <span class="vp-badge tip" style="vertical-align:middle;">v1.4.4</span></h2><h3 id="黑名单操作的函数" tabindex="-1"><a class="header-anchor" href="#黑名单操作的函数" aria-hidden="true">#</a> 黑名单操作的函数</h3><p>添加：<code>seal.ban.addBan(ctx, uid, place, reason)</code></p><p>移除：<code>seal.ban.remove(ctx, uid)</code></p><ul><li><code>ctx</code>：<code>MsgContext</code> 类型，指令上下文，<code>solve()</code> 函数传进来的第一个参数</li><li><code>uid</code>：用户 ID，字符串类型，例如 <code>QQ:123456789</code>, <code>TG:123456789</code></li><li><code>place</code>：拉黑的地方，字符串类型，随便写，一般来说在群内拉黑就写群 ID</li><li><code>reason</code>：拉黑原因，字符串类型，随便写</li></ul><h3 id="信任用户名单" tabindex="-1"><a class="header-anchor" href="#信任用户名单" aria-hidden="true">#</a> 信任用户名单</h3><p>添加：<code>seal.ban.addTrust(ctx, uid, place, reason)</code> 参数说明同上</p><p>移除：<code>seal.ban.remove(ctx, uid)</code></p><div class="hint-container tip"><p class="hint-container-title">相同的移除函数</p><p>黑名单和信任名单存储在同一个数据库中，因此移除时使用的是同一个函数。</p><p>你在进行移除操作时需要自己判断是否符合你的预期。</p></div><h3 id="获取黑名单-信任名单列表" tabindex="-1"><a class="header-anchor" href="#获取黑名单-信任名单列表" aria-hidden="true">#</a> 获取黑名单 / 信任名单列表</h3><p>使用 <code>seal.ban.getList()</code></p><p>返回值为一个数组，数组中的每一项都是一个 <code>BanListInfoItem</code> 对象，包含以下字段：</p><ul><li><code>id</code>：用户 ID，字符串类型</li><li><code>name</code>：用户昵称，字符串类型</li><li><code>score</code>：怒气值，整数类型</li><li><code>rank</code>：拉黑/信任等级 0 没事 -10警告 -30禁止 30信任</li><li><code>times</code>：事发时间，数组类型，内部元素为整数时间戳</li><li><code>reasons</code>：拉黑/信任原因，数组类型，内部元素为字符串</li><li><code>places</code>：拉黑/信任的发生地点，数组类型，内部元素为字符串</li><li><code>banTime</code>：拉黑/信任的时间，整数时间戳</li></ul><h3 id="获取用户在黑名单-信任名单中的信息" tabindex="-1"><a class="header-anchor" href="#获取用户在黑名单-信任名单中的信息" aria-hidden="true">#</a> 获取用户在黑名单 / 信任名单中的信息</h3><p>使用 <code>seal.ban.getUser(uid)</code></p><p>如果用户没有在黑名单 / 信任名单中，返回值为空值。</p><p>如果有则返回一个 <code>BanListInfoItem</code> 对象，字段同上。</p><h3 id="示例代码-黑名单-信任名单操作" tabindex="-1"><a class="header-anchor" href="#示例代码-黑名单-信任名单操作" aria-hidden="true">#</a> 示例代码：黑名单 / 信任名单操作</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         js-ban</span>
<span class="token comment">// @author       SzzRain</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  演示 js 扩展操作黑名单</span>
<span class="token comment">// @timestamp    1706684850</span>
<span class="token comment">// @license      MIT</span>
<span class="token comment">// @homepageURL  https://github.com/Szzrain</span>
<span class="token comment">// ==/UserScript==</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;js-ban&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">const</span> ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&#39;js-ban&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;SzzRain&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1.0.0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建一个命令</span>
    <span class="token keyword">const</span> cmdcban <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cmdcban<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;cban&#39;</span><span class="token punctuation">;</span>
    cmdcban<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;使用.cban &lt;用户id&gt; 来拉黑目标用户，仅master可用&#39;</span><span class="token punctuation">;</span>
    cmdcban<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&#39;help&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>privilegeLevel <span class="token operator">===</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    seal<span class="token punctuation">.</span>ban<span class="token punctuation">.</span><span class="token function">addBan</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> val<span class="token punctuation">,</span> <span class="token string">&quot;JS扩展拉黑&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;JS扩展拉黑测试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&quot;已拉黑用户&quot;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&quot;你没有权限执行此命令&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 注册命令</span>
    ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;cban&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdcban<span class="token punctuation">;</span>

    <span class="token comment">// 创建一个命令</span>
    <span class="token keyword">const</span> cmdcunban <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cmdcunban<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;cunban&#39;</span><span class="token punctuation">;</span>
    cmdcunban<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;使用.cunban &lt;用户id&gt; 来解除拉黑/移除信任目标用户，仅master可用&#39;</span><span class="token punctuation">;</span>
    cmdcunban<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&#39;help&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>privilegeLevel <span class="token operator">===</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 信任用户和拉黑用户存在同一个列表中，remove 前请先判断是否符合预期</span>
                    seal<span class="token punctuation">.</span>ban<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&quot;已解除拉黑/信任用户&quot;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&quot;你没有权限执行此命令&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 注册命令</span>
    ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;cunban&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdcunban<span class="token punctuation">;</span>

    <span class="token comment">// 创建一个命令</span>
    <span class="token keyword">const</span> cmdctrust <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cmdctrust<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;ctrust&#39;</span><span class="token punctuation">;</span>
    cmdctrust<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;使用.ctrust &lt;用户id&gt; 来信任目标用户，仅master可用&#39;</span><span class="token punctuation">;</span>
    cmdctrust<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&#39;help&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>privilegeLevel <span class="token operator">===</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    seal<span class="token punctuation">.</span>ban<span class="token punctuation">.</span><span class="token function">addTrust</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> val<span class="token punctuation">,</span> <span class="token string">&quot;JS扩展信任&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;JS扩展信任测试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&quot;已信任用户&quot;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&quot;你没有权限执行此命令&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 注册命令</span>
    ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;ctrust&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdctrust<span class="token punctuation">;</span>

    <span class="token comment">// 创建一个命令</span>
    <span class="token keyword">const</span> cmdcbanlist <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cmdcbanlist<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;cbanlist&#39;</span><span class="token punctuation">;</span>
    cmdcbanlist<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;使用.cbanlist 来查看黑名单和信任列表，仅master可用&#39;</span><span class="token punctuation">;</span>
    cmdcbanlist<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&#39;help&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>privilegeLevel <span class="token operator">===</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">&quot;黑名单/信任列表：\n&quot;</span><span class="token punctuation">;</span>
                    seal<span class="token punctuation">.</span>ban<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        text <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) 当前等级:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token punctuation">.</span>rank<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 怒气值:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token punctuation">.</span>score<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&quot;你没有权限执行此命令&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 注册命令</span>
    ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;cbanlist&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdcbanlist<span class="token punctuation">;</span>

    <span class="token comment">// 创建一个命令</span>
    <span class="token keyword">const</span> cmdcget <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cmdcget<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;cget&#39;</span><span class="token punctuation">;</span>
    cmdcget<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;使用.cget &lt;用户id&gt; 来查看目标用户的黑名单/信任信息，仅master可用&#39;</span><span class="token punctuation">;</span>
    cmdcget<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&#39;help&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>privilegeLevel <span class="token operator">===</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> info <span class="token operator">=</span> seal<span class="token punctuation">.</span>ban<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&quot;用户不存在或未被拉黑/信任&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">let</span> level <span class="token operator">=</span> info<span class="token punctuation">.</span>rank<span class="token punctuation">;</span>
                    <span class="token comment">// 不知道为什么，用 === 是 false</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>rank <span class="token operator">==</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        level <span class="token operator">=</span> <span class="token string">&quot;信任&quot;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>rank <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        level <span class="token operator">=</span> <span class="token string">&quot;拉黑&quot;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>rank <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        level <span class="token operator">=</span> <span class="token string">&quot;警告&quot;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">用户</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>info<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>info<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) 当前等级:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>level<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 怒气值:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>info<span class="token punctuation">.</span>score<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&quot;你没有权限执行此命令&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 注册命令</span>
    ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;cget&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdcget<span class="token punctuation">;</span>

    <span class="token comment">// 注册扩展</span>
    seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="存取数据" tabindex="-1"><a class="header-anchor" href="#存取数据" aria-hidden="true">#</a> 存取数据</h2><p>相关的 API 是两个函数，<code>ExtInfo.storageSet(key, value)</code> 函数和 <code>ExtInfo.storageGet(key)</code>，一个存，一个取。</p><p><strong>关于 key：</strong></p><p>存储时需要指定 key，你可以设定为你的扩展的名字，也可以设定为其他的，注意不要和别的扩展的 key 重名就可以了。</p><p>就好比你在商场门口想要把随身物品存进暂存柜中，需要先找到个和别人不重复的柜子，避免放错地方或者取错东西。</p><p><strong>关于 value：</strong></p><p>存放的数据是字符串类型，且只能存一个，但如果想要存放更多的数据以及非字符串类型的数据怎么办？</p><p>答案是使用 <code>JSON.stringify()</code> 函数将存储了数据的 JS 对象转换为 <a href="https://www.runoob.com/json/json-tutorial.html" target="_blank" rel="noopener noreferrer">JSON<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 字符串，存储起来，需要取出的时候，再使用 <code>JSON.parse()</code> 函数将数据再转换为 JS 对象。。</p><h3 id="示例代码-投喂插件" tabindex="-1"><a class="header-anchor" href="#示例代码-投喂插件" aria-hidden="true">#</a> 示例代码：投喂插件</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         示例：存储数据</span>
<span class="token comment">// @author       木落</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  投喂，格式 .投喂 &lt;物品&gt;</span>
<span class="token comment">// @timestamp    1672423909</span>
<span class="token comment">// 2022-12-31</span>
<span class="token comment">// @license      Apache-2</span>
<span class="token comment">// @homepageURL  https://github.com/sealdice/javascript</span>
<span class="token comment">// ==/UserScript==</span>

<span class="token comment">// 先将扩展模块创建出来，如果已创建就直接使用</span>
<span class="token keyword">let</span> ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;木落&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1.0.0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> cmdFeed <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cmdFeed<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;投喂&#39;</span><span class="token punctuation">;</span>
cmdFeed<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;投喂，格式：.投喂 &lt;物品&gt;\n.投喂 记录 // 查看记录&#39;</span><span class="token punctuation">;</span>
cmdFeed<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;help&#39;</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token string">&#39;&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// .投喂 help</span>
      <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">&#39;列表&#39;</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token string">&#39;记录&#39;</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token string">&#39;list&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ext<span class="token punctuation">.</span><span class="token function">storageGet</span><span class="token punctuation">(</span><span class="token string">&#39;feedInfo&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;{}&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lst<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: 数量 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">投喂记录:\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lst<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;\n&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ext<span class="token punctuation">.</span><span class="token function">storageGet</span><span class="token punctuation">(</span><span class="token string">&#39;feedInfo&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;{}&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> name <span class="token operator">=</span> val <span class="token operator">||</span> <span class="token string">&#39;空气&#39;</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      data<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      ext<span class="token punctuation">.</span><span class="token function">storageSet</span><span class="token punctuation">(</span><span class="token string">&#39;feedInfo&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你给海豹投喂了</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，要爱护动物！</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 将命令注册到扩展中</span>
ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;投喂&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdFeed<span class="token punctuation">;</span>
ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;feed&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdFeed<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="示例代码-群内安价收集" tabindex="-1"><a class="header-anchor" href="#示例代码-群内安价收集" aria-hidden="true">#</a> 示例代码：群内安价收集</h3><p>这是关于数据的增加、删除、查询等操作的实现示例（修改的话就是删除之后增加）</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         群内安价收集</span>
<span class="token comment">// @author       憧憬少</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  在群内收集群友给出的安价选项，并掷骰得出结果</span>
<span class="token comment">// @timestamp    1676386517</span>
<span class="token comment">// 2023-02-14 22:55:17</span>
<span class="token comment">// @license      MIT</span>
<span class="token comment">// @homepageURL  https://github.com/ChangingSelf/sealdice-js-ext-anchor</span>
<span class="token comment">// ==/UserScript==</span>

<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// src/index.ts</span>
  <span class="token keyword">const</span> <span class="token constant">HELP</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">群内安价收集 (ak 是アンカー罗马字缩写)
注意 ak 后面有空格，“.ak”也可以换成“.安价”

.ak help // 查看帮助
.ak # 标题 // 新建一轮分歧并设标题
.ak + 选项 // 需要添加的选项的内容
.ak - 序号 // 需要移除的选项的序号
.ak ? // 列出目前所有选项
.ak = // 随机抽取 1 个选项并继续
.ak = n // 随机抽取 n 个选项并继续
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token constant">STORAGE_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;anchor&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token constant">OPTION_NUM_PER_PAGE</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span> <span class="token comment">// 列出所有选项时，每页放多少个选项</span>
  <span class="token keyword">function</span> <span class="token function">akNew</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> title</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;title&quot;</span><span class="token operator">:</span> title<span class="token punctuation">,</span>
      <span class="token string-property property">&quot;options&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    ext<span class="token punctuation">.</span><span class="token function">storageSet</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">已新建分歧:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">akAdd</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> option</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ext<span class="token punctuation">.</span><span class="token function">storageGet</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;{&quot;title&quot;:&quot;&quot;,&quot;options&quot;:[]}&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前分歧:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
已添加第</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>options<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">个选项:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>option<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ext<span class="token punctuation">.</span><span class="token function">storageSet</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">akDel</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ext<span class="token punctuation">.</span><span class="token function">storageGet</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;{&quot;title&quot;:&quot;&quot;,&quot;options&quot;:[]}&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> removed <span class="token operator">=</span> data<span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前分歧:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
已移除第</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">个选项:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>removed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ext<span class="token punctuation">.</span><span class="token function">storageSet</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">akList</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ext<span class="token punctuation">.</span><span class="token function">storageGet</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;{&quot;title&quot;:&quot;&quot;,&quot;options&quot;:[]}&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>options<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前分歧:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
还没有任何选项呢</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> optStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> curPageRows <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      optStr <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token operator">++</span>curPageRows<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>curPageRows <span class="token operator">&gt;=</span> <span class="token constant">OPTION_NUM_PER_PAGE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前分歧:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>optStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        optStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        curPageRows <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>curPageRows <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前分歧:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>optStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> min<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">akGet</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> num <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ext<span class="token punctuation">.</span><span class="token function">storageGet</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;{&quot;title&quot;:&quot;&quot;,&quot;options&quot;:[]}&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>options<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前分歧:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
还没有任何选项呢</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">akList</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> optStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>options<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> data<span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      optStr <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">结果是:
</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>optStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ext<span class="token punctuation">.</span><span class="token function">storageSet</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;anchor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&quot;anchor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;憧憬少&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> cmdSeal <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cmdSeal<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;安价&quot;</span><span class="token punctuation">;</span>
    cmdSeal<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token constant">HELP</span><span class="token punctuation">;</span>
    cmdSeal<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">case</span> <span class="token string">&quot;#&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> title <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">akNew</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">case</span> <span class="token string">&quot;+&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> option <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">akAdd</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> option<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">case</span> <span class="token string">&quot;-&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">akDel</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">case</span> <span class="token string">&quot;?&quot;</span><span class="token operator">:</span>
          <span class="token keyword">case</span> <span class="token string">&quot;？&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function">akList</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">case</span> <span class="token string">&quot;=&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cmdArgs<span class="token punctuation">.</span>args<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              num <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">akGet</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">case</span> <span class="token string">&quot;help&quot;</span><span class="token operator">:</span>
          <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> error<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&quot;安价&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdSeal<span class="token punctuation">;</span>
    ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&quot;ak&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdSeal<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="数据处理模板" tabindex="-1"><a class="header-anchor" href="#数据处理模板" aria-hidden="true">#</a> 数据处理模板</h2><p>关于取出数据来修改的函数，可以参考如下代码：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">STORAGE_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;anchor&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 将你的 key 抽出来单独作为一个常量，方便开发阶段修改（使用了之后就不要修改了）</span>
<span class="token comment">//函数：添加选项</span>
<span class="token keyword">function</span> <span class="token function">akAdd</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> option</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//取出数据</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ext<span class="token punctuation">.</span><span class="token function">storageGet</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;{&quot;title&quot;:&quot;&quot;,&quot;options&quot;:[]}&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//处理数据</span>
    data<span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//响应发送者</span>
    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前分歧:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n已添加第</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>options<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">个选项:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>option<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//将处理完的数据写回去</span>
    ext<span class="token punctuation">.</span><span class="token function">storageSet</span><span class="token punctuation">(</span><span class="token constant">STORAGE_KEY</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="读取玩家或群组数据" tabindex="-1"><a class="header-anchor" href="#读取玩家或群组数据" aria-hidden="true">#</a> 读取玩家或群组数据</h2><p>可以查看下文的 <a href="#js-%E6%89%A9%E5%B1%95-api">API</a>。</p><h2 id="编写暗骰指令" tabindex="-1"><a class="header-anchor" href="#编写暗骰指令" aria-hidden="true">#</a> 编写暗骰指令</h2><p>如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         示例：编写暗骰指令</span>
<span class="token comment">// @author       流溪</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  暗骰，格式.hide 原因</span>
<span class="token comment">// @timestamp    1671540835</span>
<span class="token comment">// 2022-12-20</span>
<span class="token comment">// @license      Apache-2</span>
<span class="token comment">// @homepageURL  https://github.com/sealdice/javascript</span>
<span class="token comment">// ==/UserScript==</span>
ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;hide&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ext<span class="token punctuation">)</span><span class="token punctuation">{</span>
    ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&#39;hide&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;流溪&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;0.0.1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> cmdHide <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>newCmdItemInfo<span class="token punctuation">;</span>
cmdHide<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;hide&#39;</span><span class="token punctuation">;</span>
cmdHide<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;暗骰，使用 .hide 面数 暗骰&#39;</span><span class="token punctuation">;</span>
cmdHide<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>messageType <span class="token operator">!==</span> <span class="token string">&#39;group&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&#39;暗骰只能在群内触发&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">rd</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 这里写的时候有点不清醒了，感觉是对的，如果不对请拷打我</span>
        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token string">&#39;help&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>showhelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 我知道这里有更好的判断是否为数字的方法但是我不会.jpg</span>
        seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">骰子面数应是数字</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这就是暗骰 api 哒！</span>
        seal<span class="token punctuation">.</span><span class="token function">replyPerson</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你在群</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token punctuation">.</span>groupId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">的掷骰结果为：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">rd</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;hide&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdHide<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到使用<code>seal.replyPerson</code>做到暗骰的效果。</p><h2 id="编写代骰指令" tabindex="-1"><a class="header-anchor" href="#编写代骰指令" aria-hidden="true">#</a> 编写代骰指令</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         示例：编写代骰指令</span>
<span class="token comment">// @author       木落</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  捕捉某人，格式.catch &lt;@名字&gt;</span>
<span class="token comment">// @timestamp    1671540835</span>
<span class="token comment">// 2022-12-20</span>
<span class="token comment">// @license      Apache-2</span>
<span class="token comment">// @homepageURL  https://github.com/sealdice/javascript</span>
<span class="token comment">// ==/UserScript==</span>

<span class="token comment">// 编写代骰指令</span>
<span class="token comment">// 先将扩展模块创建出来，如果已创建就直接使用</span>
<span class="token keyword">let</span> ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;木落&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1.0.0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 创建指令 .catch</span>
<span class="token comment">// 这个命令的功能为，显示“试图捕捉某人”，并给出成功率</span>
<span class="token comment">// 如果命令写“.catch @张三”，那么就会试着捕捉张三</span>
<span class="token keyword">const</span> cmdCatch <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cmdCatch<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;catch&#39;</span><span class="token punctuation">;</span>
cmdCatch<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;捕捉某人，格式.catch &lt;@名字&gt;&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 对这个指令启用使用代骰功能，即@某人时，可获取对方的数据，以对方身份进行骰点</span>
cmdCatch<span class="token punctuation">.</span>allowDelegate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
cmdCatch<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取对方数据，之后用 mctx 替代 ctx，mctx 下读出的数据即被代骰者的个人数据</span>
  <span class="token keyword">const</span> mctx <span class="token operator">=</span> seal<span class="token punctuation">.</span><span class="token function">getCtxProxyFirst</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;help&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 命令为 .catch help</span>
      <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">正在试图捕捉</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mctx<span class="token punctuation">.</span>player<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，成功率为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>mctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 将命令注册到扩展中</span>
ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;catch&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdCatch<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="网络请求" tabindex="-1"><a class="header-anchor" href="#网络请求" aria-hidden="true">#</a> 网络请求</h2><p>主要使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 进行网络请求，详细文档见链接。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 你可以使用 async/await 和 generator 来重写这段代码，欢迎 pr</span>
<span class="token comment">// 访问网址</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;https://api-music.imsyy.top/cloudsearch?keywords=稻香&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在返回对象的基础上，将文本流作为 json 解析</span>
  resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 打印解析出的数据</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>套用这个模板，你可以写出很多调用 API 的简单扩展。</p><p>比如核心代码只有一行的「<a href="https://github.com/sealdice/javascript/blob/main/scripts/%E5%A8%B1%E4%B9%90%E5%90%91/%E9%9A%8F%E6%9C%BA%E7%8C%AB%E7%8C%AB%E5%9B%BE%E7%89%87.js" target="_blank" rel="noopener noreferrer">随机猫猫图片<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>」扩展：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[CQ:image,file=https://thiscatdoesnotexist.com/,cache=0]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>核心代码同样只有一行的「随机二次元图片」扩展：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[CQ:image,file=https://api.oick.cn/random/api.php?type=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,cache=0]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>当然，也有稍微复杂的，比如「<a href="https://github.com/sealdice/javascript/blob/main/scripts/%E5%A8%B1%E4%B9%90%E5%90%91/dicemaid-ai.js" target="_blank" rel="noopener noreferrer">AI 骰娘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>」扩展，但也没有太复杂，只是处理了一下发送者传过来的消息，再发送给网络 API，收到响应之后再回应发送者。</p><p>它的核心代码如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">BID</span> <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 填入你的骰娘的大脑的 id</span>
<span class="token keyword">const</span> <span class="token constant">KEY</span> <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 填入你的 key</span>
<span class="token doc-comment comment">/**
 * 给 AI 主脑发送消息并接收回复
 * <span class="token keyword">@param</span> <span class="token parameter">ctx</span> 主要是和当前环境以及用户相关的内容，如当前发指令用户，当前群组信息等
 * <span class="token keyword">@param</span> <span class="token parameter">msg</span> 为原生态的指令内容，如指令文本，发送平台，发送时间等
 * <span class="token keyword">@param</span> <span class="token parameter">message</span> 要发送给骰娘的具体消息
 */</span>
<span class="token keyword">function</span> <span class="token function">chatWithBot</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span>msg<span class="token punctuation">,</span>message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://api.brainshop.ai/get?bid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BID</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;key=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">KEY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;uid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">.</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;msg=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">抱歉，我连接不上主脑了。它传递过来的信息是：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">&quot;cnt&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自定义-coc-规则" tabindex="-1"><a class="header-anchor" href="#自定义-coc-规则" aria-hidden="true">#</a> 自定义 COC 规则</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         示例：自定义 COC 规则</span>
<span class="token comment">// @author       木落</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  自设规则，出 1 大成功，出 100 大失败。困难极难等保持原样</span>
<span class="token comment">// @timestamp    1671886435</span>
<span class="token comment">// 2022-12-24</span>
<span class="token comment">// @license      Apache-2</span>
<span class="token comment">// @homepageURL  https://github.com/sealdice/javascript</span>
<span class="token comment">// ==/UserScript==</span>

<span class="token keyword">const</span> rule <span class="token operator">=</span> seal<span class="token punctuation">.</span>coc<span class="token punctuation">.</span><span class="token function">newRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rule<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 自定义序号必须大于等于 20，代表可用.setcoc 20 切换</span>
rule<span class="token punctuation">.</span>key <span class="token operator">=</span> <span class="token string">&#39;测试&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 代表可用 .setcoc 测试 切换</span>
rule<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;自设规则&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 已切换至规则文本 name: desc</span>
rule<span class="token punctuation">.</span>desc <span class="token operator">=</span> <span class="token string">&#39;出 1 大成功\n出 100 大失败&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// d100 为出目，checkValue 为技能点数</span>
rule<span class="token punctuation">.</span><span class="token function-variable function">check</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> d100<span class="token punctuation">,</span> checkValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> successRank <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> criticalSuccessValue <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fumbleValue <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>d100 <span class="token operator">&lt;=</span> checkValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    successRank <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    successRank <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 成功判定</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>successRank <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 区分大成功、困难成功、极难成功等</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>d100 <span class="token operator">&lt;=</span> checkValue <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//suffix = &quot;成功(困难)&quot;</span>
      successRank <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>d100 <span class="token operator">&lt;=</span> checkValue <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//suffix = &quot;成功(极难)&quot;</span>
      successRank <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>d100 <span class="token operator">&lt;=</span> criticalSuccessValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//suffix = &quot;大成功！&quot;</span>
      successRank <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>d100 <span class="token operator">&gt;=</span> fumbleValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//suffix = &quot;大失败！&quot;</span>
      successRank <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>coc<span class="token punctuation">.</span><span class="token function">newRuleCheckResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ret<span class="token punctuation">.</span>successRank <span class="token operator">=</span> successRank<span class="token punctuation">;</span>
  ret<span class="token punctuation">.</span>criticalSuccessValue <span class="token operator">=</span> criticalSuccessValue<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 注册规则</span>
seal<span class="token punctuation">.</span>coc<span class="token punctuation">.</span><span class="token function">registerRule</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="补充-使用非指令关键词" tabindex="-1"><a class="header-anchor" href="#补充-使用非指令关键词" aria-hidden="true">#</a> 补充：使用非指令关键词</h2><blockquote><p>你是否因为自定义回复能实现的功能有限而烦恼？你是否因为自定义回复的匹配方式不全而愤怒？你是否因为自定义回复只能调用图片 api 而感到焦头烂额？</p><p>不要紧张，我的朋友，试试非指令关键词，这会非常有用。</p></blockquote><p>通常情况下，我们使用 <code>ext.onNotCommandReceived</code> 作为非指令关键词的标志；这限定了只有在未收到命令且未达成自定义回复时，海豹才会触发此流程。</p><p>一个完整的非指令关键词模板如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 必要流程，注册扩展，注意即使是非指令关键词也是依附于扩展的</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;xxx&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&#39;xxx&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;xxx&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;x.x.x&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 这里其实是编写处理函数</span>
    ext<span class="token punctuation">.</span><span class="token function-variable function">onNotCommandReceived</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> message <span class="token operator">=</span> msg<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
        <span class="token comment">// 这里请自己处理要如何达成 message 的匹配条件，js 那么多的匹配方法，足够你玩出花来。</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// 匹配到关键词了，要干什么？</span>
          xxx<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="注册插件配置项" tabindex="-1"><a class="header-anchor" href="#注册插件配置项" aria-hidden="true">#</a> 注册插件配置项 <span class="vp-badge tip" style="vertical-align:middle;">v1.4.1</span></h2><p>插件若要在 UI 中注册可供用户修改的配置项，需要在插件注册后调用 <code>seal.ext.registerXXXConfig()</code> 函数注册配置项。</p><p><code>XXX</code> 为配置项的类型，目前支持 <code>string</code>、<code>int</code>、<code>float</code>、<code>bool</code>、<code>template</code>、<code>option</code> 六种类型。注意按照小驼峰命名法大写</p><p>同样的，插件也可以使用 <code>seal.ext.getXXXConfig()</code> 函数获取配置项的值。</p><p>你也可以直接使用 <code>seal.ext.getConfig()</code> 函数获取配置项的值，这个函数会返回一个 <code>ConfigItem</code> 对象， 包含了配置项的类型、值、默认值等信息。</p><p><code>ConfigItem</code> 对象的类型定义如下，调用时请使用 <code>jsbind</code> 中的值作为 <code>key</code></p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> ConfigItem <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Key          <span class="token builtin">string</span>      <span class="token string">`json:&quot;key&quot; jsbind:&quot;key&quot;`</span>
	Type         <span class="token builtin">string</span>      <span class="token string">`json:&quot;type&quot; jsbind:&quot;type&quot;`</span>
	DefaultValue <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token string">`json:&quot;defaultValue&quot; jsbind:&quot;defaultValue&quot;`</span>
	Value        <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token string">`json:&quot;value,omitempty&quot; jsbind:&quot;value&quot;`</span>
	Option       <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token string">`json:&quot;option,omitempty&quot; jsbind:&quot;option&quot;`</span>
	Deprecated   <span class="token builtin">bool</span>        <span class="token string">`json:&quot;deprecated,omitempty&quot; jsbind:&quot;deprecated&quot;`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">更原始的 API</p><p><code>seal.ext.registerConfig()</code> 函数也是可以使用的，你需要自己通过 <code>seal.ext.newConfigItem()</code> 来获取一个新的 <code>ConfigItem</code> 对象。</p><p>在对你的 <code>ConfigItem</code> 对象进行修改后，再调用 <code>seal.ext.registerConfig()</code> 函数进行注册。</p></div><h3 id="示例代码-注册配置项" tabindex="-1"><a class="header-anchor" href="#示例代码-注册配置项" aria-hidden="true">#</a> 示例代码：注册配置项</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         js-config-example</span>
<span class="token comment">// @author       Szzrain</span>
<span class="token comment">// @version      1.0.0</span>
<span class="token comment">// @description  演示 js 配置项的用法</span>
<span class="token comment">// @timestamp    1698636875</span>
<span class="token comment">// @license      MIT</span>
<span class="token comment">// ==/UserScript==</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;js-config-example&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ext <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&#39;js-config-example&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;SzzRain&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1.0.0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建一个命令</span>
    <span class="token keyword">const</span> cmdgetConfig <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cmdgetConfig<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;getconfig&#39;</span><span class="token punctuation">;</span>
    cmdgetConfig<span class="token punctuation">.</span>help <span class="token operator">=</span> <span class="token string">&#39;使用.getconfig &lt;key&gt; 来获取配置项，仅 master 可用&#39;</span><span class="token punctuation">;</span>
    cmdgetConfig<span class="token punctuation">.</span>allowDelegate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    cmdgetConfig<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> val <span class="token operator">=</span> cmdArgs<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&#39;help&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> ret <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ret<span class="token punctuation">.</span>showHelp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>privilegeLevel <span class="token operator">===</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> config <span class="token operator">=</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> config<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&quot;你没有权限执行此命令&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 注册命令</span>
    ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;getconfig&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmdgetConfig<span class="token punctuation">;</span>

    <span class="token comment">// 注册扩展</span>
    seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 注册配置项需在 ext 注册后进行</span>
    <span class="token comment">// 通常来说，register 函数的参数为 ext, key, defaultValue</span>
    seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerStringConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span><span class="token string">&quot;testkey1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;testvalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerIntConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span><span class="token string">&quot;testkey2&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerFloatConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span><span class="token string">&quot;testkey3&quot;</span><span class="token punctuation">,</span> <span class="token number">123.456</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerBoolConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span><span class="token string">&quot;testkey4&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerTemplateConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span><span class="token string">&quot;testkey5&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注册单选项函数的参数为 ext, key, defaultValue, options</span>
    seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerOptionConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;testkey6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;7&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;9&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注册后的配置项会在 UI 中显示，可以在 UI 中修改配置项的值</p><figure><img src="/sealdice-manual-next/assets/js-config-example-717e902c.png" alt="JS 配置项" tabindex="0" loading="lazy"><figcaption>JS 配置项</figcaption></figure><h2 id="使用-ts-模板" tabindex="-1"><a class="header-anchor" href="#使用-ts-模板" aria-hidden="true">#</a> 使用 TS 模板</h2><h3 id="clone-或下载项目" tabindex="-1"><a class="header-anchor" href="#clone-或下载项目" aria-hidden="true">#</a> clone 或下载项目</h3><p>推荐的流程：</p><ol><li>在 <a href="https://github.com/sealdice/sealdice-js-ext-template" target="_blank" rel="noopener noreferrer">模板项目仓库<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 点击 Use this template 按钮，使用该模板在自己的 GitHub 上创建一个扩展的仓库，并设置为自己的扩展的名字；</li><li><code>git clone</code> 到本地，进行开发。</li></ol><p>如果你没有 GitHub 账号，也不会用 git：</p><ol><li>在 <a href="https://github.com/sealdice/sealdice-js-ext-template" target="_blank" rel="noopener noreferrer">模板项目仓库<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 点击 Code 按钮，在出现的浮窗中选择 Download ZIP，这样就会下载一个压缩包；</li><li>解压后进行开发。</li></ol><h3 id="使用和编译" tabindex="-1"><a class="header-anchor" href="#使用和编译" aria-hidden="true">#</a> 使用和编译</h3><p>TS 插件代码需要编译为 js 文件才能被海豹核心加载。</p><p>开始使用模板工程时，需要先将所需依赖包安装好。在确认你所使用的包管理器后，在命令行使用如下命令：</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="tab-760-0" aria-selected="true">npm</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-760-1" aria-selected="false">pnpm</button></div><!--[--><div class="vp-tab active" id="tab-760-0" role="tabpanel" aria-expanded="true"><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="vp-tab" id="tab-760-1" role="tabpanel" aria-expanded="false"><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><!--]--></div><p>当你写好了代码，需要将 ts 文件转换为 js 文件以便上传到海豹骰时，在命令行使用如下命令：</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="tab-771-0" aria-selected="true">npm</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-771-1" aria-selected="false">pnpm</button></div><!--[--><div class="vp-tab active" id="tab-771-0" role="tabpanel" aria-expanded="true"><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><div class="vp-tab" id="tab-771-1" role="tabpanel" aria-expanded="false"><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> run build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><!--]--></div><p>编译成功的 js 文件在 <code>dist</code> 目录下，默认的名字是 <code>sealdce-js-ext.js</code>。</p><h3 id="补全信息" tabindex="-1"><a class="header-anchor" href="#补全信息" aria-hidden="true">#</a> 补全信息</h3><p>当插件开发完成后（或者开始开发时），你还需要修改几处地方：</p><ul><li><code>header.txt</code>：这个文件是你插件的描述信息；</li><li><code>tools/build-config.js</code>：最开头一行 <code>var filename = &#39;sealdce-js-ext.js&#39;;</code> 改成你中意的名字，注意不要与现有的重名。</li></ul><h3 id="目录结构" tabindex="-1"><a class="header-anchor" href="#目录结构" aria-hidden="true">#</a> 目录结构</h3><p>只列出其中主要的一些文件</p><ul><li><code>src</code><ul><li><code>index.ts</code>：你的扩展的代码就写在这个文件里。</li></ul></li><li><code>tools</code><ul><li><code>build-config</code>：一些编译的配置，影响 <code>index.ts</code> 编译成 js 文件的方式；</li><li><code>build.js</code>：在命令 <code>npm run build</code> 执行时所运行的脚本，用于读取 <code>build-config</code> 并按照配置进行编译。</li></ul></li><li><code>types</code><ul><li><code>seal.d.ts</code>：类型文件，海豹核心提供的扩展 API。</li></ul></li><li><code>header.txt</code>：扩展头信息，会在编译时自动加到目标文件头部；</li><li><code>package.json</code>：命令 <code>npm install</code> 时就在安装这个文件里面所指示的依赖包；</li><li><code>tsconfig.json</code>：typescript 的配置。</li></ul><h2 id="js-扩展-api" tabindex="-1"><a class="header-anchor" href="#js-扩展-api" aria-hidden="true">#</a> JS 扩展 API</h2><blockquote><p>这里只是粗略的整理，具体请看 <a href="https://github.com/sealdice/sealdice-core/blob/master/dice/dice_jsvm.go" target="_blank" rel="noopener noreferrer">jsvm 源码<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p></blockquote><p>按类别整理。</p><blockquote><p>其中 ctx 为信息的 MsgContext，msg 为信息的 Message，一般会在定义指令函数时就声明，如：</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>cmd<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    someFunction<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面是 api 的说明（完全了吧......应该？）：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//被注释掉的 api 是可以提供的，但是在源码中被注释。</span>
<span class="token comment">//seal.setVarInt(ctx, `$XXX`, valueToSet) //`$XXX`即 rollvm（初阶豹语）中的变量，其会将$XXX 的值设定为 int 类型的 valueToSet。</span>
<span class="token comment">//seal.setVarStr(ctx, `$XXX`, valueToSet) //同上，区别是设定的为 str 类型的 valueToSet。</span>
seal<span class="token punctuation">.</span><span class="token function">replyGroup</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> something<span class="token punctuation">)</span> <span class="token comment">//向收到指令的群中发送 something。</span>
seal<span class="token punctuation">.</span><span class="token function">replyPerson</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> something<span class="token punctuation">)</span> <span class="token comment">//顾名思义，类似暗骰，向指令触发者（若为好友）私信 something。</span>
seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> something<span class="token punctuation">)</span> <span class="token comment">//同上，区别是群内收到就群内发送，私聊收到就私聊发送。</span>
seal<span class="token punctuation">.</span><span class="token function">memberBan</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> groupID<span class="token punctuation">,</span> userID<span class="token punctuation">,</span> dur<span class="token punctuation">)</span> <span class="token comment">//将指定群的指定用户封禁指定时间 (似乎只实现了 walleq 协议？)</span>
seal<span class="token punctuation">.</span><span class="token function">memberKick</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> groupID<span class="token punctuation">,</span> userID<span class="token punctuation">)</span>  <span class="token comment">//将指定群的指定用户踢出 (似乎也只实现了 walleq 协议？)</span>
seal<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> something<span class="token punctuation">)</span> <span class="token comment">//将 something 经过一层 rollvm 转译并返回，注意需要配合 replyToSender 才能发送给触发者！</span>
seal<span class="token punctuation">.</span><span class="token function">formatTmpl</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> something<span class="token punctuation">)</span> <span class="token comment">//调用自定义文案 something</span>
seal<span class="token punctuation">.</span><span class="token function">getCtxProxyFirst</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> cmdArgs<span class="token punctuation">)</span>  <span class="token comment">//获取被 at 的第一个人，等价于 getCtxProxyAtPos(ctx, 0)</span>
seal<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">intGet</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$XXX</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">//返回一个数组，其为 `[int 类型的触发者的该变量的值，bool]` 当 strGet 一个 int 或 intGet 一个 str 时 bool 为 false，若一切正常则为 true。（之所以会有这么奇怪的说法是因为 rollvm 的「个人变量」机制）。</span>
seal<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">intSet</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$XXX</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> valueToSet<span class="token punctuation">)</span> <span class="token comment">//`$XXX` 即 rollvm（初阶豹语）中的变量，其会将 $XXX 的值设定为 int 类型的 valueToSet。</span>
seal<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">strGet</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$XXX</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">//返回一个数组，其为 `[str 类型的触发者的该变量的值，bool]`（之所以会有这么奇怪的说法是因为 rollvm 的「个人变量」机制），当 strGet 一个 int 或 intGet 一个 str 时 bool 为 false，如果一切正常则为 true。</span>
seal<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">strSet</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$XXX</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> valueToSet<span class="token punctuation">)</span> <span class="token comment">//`$XXX` 即 rollvm（初阶豹语）中的变量，其会将 $XXX 的值设定为 str 类型的 valueToSet。</span>
<span class="token comment">//seal.vars.varSet(ctx, `$XXX`, valueToSet) //可能是根据数据类型自动推断 int 或 str？</span>
<span class="token comment">//seal.vars.varGet(ctx, `$XXX`) //同上</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdItemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//用来定义新的指令；没有参数，个人觉得可以视其为类（class）。</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newCmdExecuteResult</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token comment">//用于判断指令执行结果，true 为成功，false 为失败。</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>extName<span class="token punctuation">,</span> extAuthor<span class="token punctuation">,</span> Version<span class="token punctuation">)</span> <span class="token comment">//用于建立一个名为 extName，作者为 extAuthor，版本为 Version 的扩展。注意，extName，extAuthor 和 Version 均为字符串。</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>extName<span class="token punctuation">)</span> <span class="token comment">//用于查找名为 extname 的扩展，若存在则返回 true，否则返回 false。</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>newExt<span class="token punctuation">)</span> <span class="token comment">//将扩展 newExt 注册到系统中。注意 newExt 是 seal.ext.new 的返回值，将 register 视为 seal.ext.new() 是错误的。</span>
seal<span class="token punctuation">.</span>coc<span class="token punctuation">.</span><span class="token function">newRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//用来创建自定义 coc 规则，github.com/sealdice/javascript/examples 中已有详细例子，不多赘述。</span>
seal<span class="token punctuation">.</span>coc<span class="token punctuation">.</span><span class="token function">newRuleCheckResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//同上，不多赘述。</span>
seal<span class="token punctuation">.</span>coc<span class="token punctuation">.</span><span class="token function">registerRule</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span> <span class="token comment">//同上，不多赘述。</span>
seal<span class="token punctuation">.</span>deck<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> deckname<span class="token punctuation">,</span> isShuffle<span class="token punctuation">)</span> <span class="token comment">//他会返回一个抽取牌堆的结果。这里有些复杂：deckname 为需要抽取的牌堆名，而 isShuffle 则是一个布尔值，它决定是否放回抽取；false 为放回，true 为不放回。</span>
seal<span class="token punctuation">.</span>deck<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//重新加载牌堆。</span>
<span class="token comment">//下面是 1.2 新增 api</span>
seal<span class="token punctuation">.</span><span class="token function">newMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//返回一个空白的 Message 对象，结构与收到消息的 msg 相同</span>
seal<span class="token punctuation">.</span><span class="token function">createTempCtx</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> msg<span class="token punctuation">)</span> <span class="token comment">// 制作一个 ctx, 需要 msg.MessageType 和 msg.Sender.UserId</span>
seal<span class="token punctuation">.</span><span class="token function">applyPlayerGroupCardByTemplate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> tmpl<span class="token punctuation">)</span> <span class="token comment">// 设定当前 ctx 玩家的自动名片格式</span>
seal<span class="token punctuation">.</span>gameSystem<span class="token punctuation">.</span><span class="token function">newTemplate</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token comment">//从 json 解析新的游戏规则。</span>
seal<span class="token punctuation">.</span>gameSystem<span class="token punctuation">.</span><span class="token function">newTemplateByYaml</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token comment">//从 yaml 解析新的游戏规则。</span>
seal<span class="token punctuation">.</span><span class="token function">getCtxProxyAtPos</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> pos<span class="token punctuation">)</span> <span class="token comment">//获取第 pos 个被 at 的人，pos 从 0 开始计数</span>
seal<span class="token punctuation">.</span><span class="token function">atob</span><span class="token punctuation">(</span>base64String<span class="token punctuation">)</span> <span class="token comment">//返回被解码的 base64 编码</span>
seal<span class="token punctuation">.</span><span class="token function">btoa</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token comment">//将 string 编码为 base64 并返回</span>

<span class="token comment">//下面是 1.4.1 新增 api</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">newConfigItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//用于创建一个新的配置项，返回一个 ConfigItem 对象</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerConfig</span><span class="token punctuation">(</span>configItem<span class="token punctuation">)</span> <span class="token comment">//用于注册一个配置项，参数为 ConfigItem 对象</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span> <span class="token comment">//用于获取一个配置项的值，参数为扩展对象和配置项的 key</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerStringConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;defaultValue&quot;</span><span class="token punctuation">)</span> <span class="token comment">//用于注册一个 string 类型的配置项，参数为扩展对象、配置项的 key 和默认值</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerIntConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span> <span class="token comment">//用于注册一个 int 类型的配置项，参数为扩展对象、配置项的 key 和默认值</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerFloatConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token number">123.456</span><span class="token punctuation">)</span> <span class="token comment">//用于注册一个 float 类型的配置项，参数为扩展对象、配置项的 key 和默认值</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerBoolConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">//用于注册一个 bool 类型的配置项，参数为扩展对象、配置项的 key 和默认值</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerTemplateConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//用于注册一个 template 类型的配置项，参数为扩展对象、配置项的 key 和默认值</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">registerOptionConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;7&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;9&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//用于注册一个 option 类型的配置项，参数为扩展对象、配置项的 key、默认值和可选项</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">getStringConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span> <span class="token comment">//用于获取一个 string 类型配置项的值，参数为扩展对象和配置项的 key</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">getIntConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span> <span class="token comment">//用于获取一个 int 类型配置项的值，参数为扩展对象和配置项的 key</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">getFloatConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span> <span class="token comment">//用于获取一个 float 类型配置项的值，参数为扩展对象和配置项的 key</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">getBoolConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span> <span class="token comment">//用于获取一个 bool 类型配置项的值，参数为扩展对象和配置项的 key</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">getTemplateConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span> <span class="token comment">//用于获取一个 template 类型配置项的值，参数为扩展对象和配置项的 key</span>
seal<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">getOptionConfig</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span> <span class="token comment">//用于获取一个 option 类型配置项的值，参数为扩展对象和配置项的 key</span>

<span class="token comment">//下面是 1.4.4 新增 api</span>
<span class="token function">setPlayerGroupCard</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> tmpl<span class="token punctuation">)</span> <span class="token comment">//设置当前 ctx 玩家的名片</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!-- TODO: 添加 1.4.1 中新增的插件配置项 --><h3 id="部分-api-使用示例" tabindex="-1"><a class="header-anchor" href="#部分-api-使用示例" aria-hidden="true">#</a> 部分 api 使用示例</h3><div class="hint-container note"><p class="hint-container-title">注</p><p>声明和注册扩展的代码部分已省略。</p></div><h4 id="replygroup-replyperson-replytosender" tabindex="-1"><a class="header-anchor" href="#replygroup-replyperson-replytosender" aria-hidden="true">#</a> <code>replyGroup</code> <code>replyPerson</code> <code>replyToSender</code></h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//在私聊触发 replyGroup 不会回复</span>
seal<span class="token punctuation">.</span><span class="token function">replyGroup</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&#39;something&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//触发者会收到&quot;something&quot;的回复</span>
seal<span class="token punctuation">.</span><span class="token function">replyPerson</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&#39;something&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//触发者会收到&quot;something&quot;的私聊回复</span>
seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token string">&#39;something&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//触发者会收到&quot;something&quot;的回复</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="memberban-memberkick" tabindex="-1"><a class="header-anchor" href="#memberban-memberkick" aria-hidden="true">#</a> <code>memberBan</code> <code>memberKick</code></h4><blockquote><p>是否保留待议</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//注意这些似乎只能在 WQ 协议上实现;</span>
seal<span class="token punctuation">.</span><span class="token function">memberBan</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> groupID<span class="token punctuation">,</span> userID<span class="token punctuation">,</span> dur<span class="token punctuation">)</span> <span class="token comment">//将群为 groupID，userid 为 userID 的人封禁 dur（单位未知）</span>
seal<span class="token punctuation">.</span><span class="token function">memberKick</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> groupID<span class="token punctuation">,</span> userID<span class="token punctuation">)</span> <span class="token comment">//将群为 groupID，userid 为 userID 的人踢出那个群</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="format-formattmpl" tabindex="-1"><a class="header-anchor" href="#format-formattmpl" aria-hidden="true">#</a> <code>format</code> <code>formatTmpl</code></h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//注意 format 不会自动 reply，而是 return，所以请套一层 reply</span>
seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> seal<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{$t玩家}的人品为：{$t人品}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//{$t人品} 是一个 rollvm 变量，其值等于 .jrrp 出的数值</span>
<span class="token comment">//回复：</span>
<span class="token comment">//群主的人品为：87</span>
seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> seal<span class="token punctuation">.</span><span class="token function">formatTmpl</span><span class="token punctuation">(</span>unknown<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//这里等大佬来了再研究</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="getctxproxyfirst-getctxproxyatpos" tabindex="-1"><a class="header-anchor" href="#getctxproxyfirst-getctxproxyatpos" aria-hidden="true">#</a> <code>getCtxProxyFirst</code> <code>getCtxProxyAtPos</code></h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>cmd<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ctxFirst <span class="token operator">=</span> seal<span class="token punctuation">.</span><span class="token function">getCtxProxyFirst</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> cmdArgs<span class="token punctuation">)</span>
    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ctxFirst<span class="token punctuation">.</span>player<span class="token punctuation">,</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmd
<span class="token comment">//输入：.test @A @B</span>
<span class="token comment">//返回：A 的名称。这里其实获取的是 A 玩家的 ctx，具体见 ctx 数据结构。</span>
cmd<span class="token punctuation">.</span><span class="token function-variable function">solve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> cmdArgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ctx3 <span class="token operator">=</span> seal<span class="token punctuation">.</span><span class="token function">getCtxProxyAtPos</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    seal<span class="token punctuation">.</span><span class="token function">replyToSender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> ctx3<span class="token punctuation">.</span>player<span class="token punctuation">,</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
ext<span class="token punctuation">.</span>cmdMap<span class="token punctuation">[</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmd
<span class="token comment">//输入：.test @A @B @C</span>
<span class="token comment">//返回：C（第三个被@的人）的名称。这里其实获取的是 C 玩家的 ctx，具体见 ctx 数据结构。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="vars" tabindex="-1"><a class="header-anchor" href="#vars" aria-hidden="true">#</a> <code>vars</code></h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 要看懂这里你可能需要学习一下初阶豹语</span>
seal<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">intSet</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$m今日打卡次数</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">//将触发者的该个人变量设置为 8</span>
seal<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">intGet</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$m今日打卡次数</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">//返回 [8,true]</span>
seal<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">strSet</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$g群友经典语录</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">我要 Git Blame 一下看看是谁写的</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">//将群内的该群组变量设置为“我要 Git Blame 一下看看是谁写的”</span>
seal<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">strGet</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$g群友经典语录</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">//返回 [&quot;我要 Git Blame 一下看看是谁写的&quot;,true]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ext" tabindex="-1"><a class="header-anchor" href="#ext" aria-hidden="true">#</a> <code>ext</code></h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//用于注册扩展和定义指令的 api，已有详细示例，不多赘述</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="coc" tabindex="-1"><a class="header-anchor" href="#coc" aria-hidden="true">#</a> <code>coc</code></h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//用于创建 coc 村规的 api，已有详细示例，不多赘述</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="deck" tabindex="-1"><a class="header-anchor" href="#deck" aria-hidden="true">#</a> <code>deck</code></h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>seal<span class="token punctuation">.</span>deck<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">煤气灯</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">//返回 放回抽取牌堆“煤气灯”的结果</span>
seal<span class="token punctuation">.</span>deck<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">煤气灯</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">//返回 不放回抽取牌堆“煤气灯”的结果</span>
seal<span class="token punctuation">.</span>deck<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//重新加载牌堆</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="自定义-trpg-规则相关" tabindex="-1"><a class="header-anchor" href="#自定义-trpg-规则相关" aria-hidden="true">#</a> 自定义 TRPG 规则相关</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//这里实在不知道如何举例了</span>
seal<span class="token punctuation">.</span>gameSystem<span class="token punctuation">.</span><span class="token function">newTemplate</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token comment">//从 json 解析新的游戏规则。</span>
seal<span class="token punctuation">.</span>gameSystem<span class="token punctuation">.</span><span class="token function">newTemplateByYaml</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token comment">//从 yaml 解析新的游戏规则。</span>
seal<span class="token punctuation">.</span><span class="token function">applyPlayerGroupCardByTemplate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> tmpl<span class="token punctuation">)</span> <span class="token comment">// 设定当前 ctx 玩家的自动名片格式</span>
<span class="token function">setPlayerGroupCard</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> tmpl<span class="token punctuation">)</span> <span class="token comment">// 立刻设定当前 ctx 玩家的名片格式</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="其他" tabindex="-1"><a class="header-anchor" href="#其他" aria-hidden="true">#</a> 其他</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>seal<span class="token punctuation">.</span><span class="token function">newMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//返回一个空白的 Message 对象，结构与收到消息的 msg 相同</span>
seal<span class="token punctuation">.</span><span class="token function">createTempCtx</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> msg<span class="token punctuation">)</span> <span class="token comment">// 制作一个 ctx, 需要 msg.MessageType 和 msg.Sender.UserId</span>
seal<span class="token punctuation">.</span><span class="token function">atob</span><span class="token punctuation">(</span>base64String<span class="token punctuation">)</span> <span class="token comment">//返回被解码的 base64 编码</span>
seal<span class="token punctuation">.</span><span class="token function">btoa</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token comment">//将 string 编码为 base64 并返回</span>
seal<span class="token punctuation">.</span><span class="token function">getEndPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//返回骰子（应该？）的 EndPoints</span>
seal<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//返回一个 map，键值为 version 和 versionCode</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ctx-的内容" tabindex="-1"><a class="header-anchor" href="#ctx-的内容" aria-hidden="true">#</a> <code>ctx</code> 的内容</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//在 github.com/sealdice/javascript/examples_ts/seal.d.ts 中有完整内容</span>
<span class="token comment">// 成员</span>
ctx<span class="token punctuation">.</span>group <span class="token comment">// 当前群信息 (对象)</span>
ctx<span class="token punctuation">.</span>player <span class="token comment">// 当前玩家数据 (对象)</span>
ctx<span class="token punctuation">.</span>endPoint <span class="token comment">// 接入点数据 (对象)</span>
<span class="token comment">// 以上三个对象内容暂略</span>
ctx<span class="token punctuation">.</span>isCurGroupBotOn <span class="token comment">// bool</span>
ctx<span class="token punctuation">.</span>isPrivate <span class="token comment">// bool 是否私聊</span>
ctx<span class="token punctuation">.</span>privilegeLevel <span class="token comment">// int 权限等级：40 邀请者、50 管理、60 群主、70 信任、100 master</span>
ctx<span class="token punctuation">.</span>delegateText <span class="token comment">// string 代骰附加文本</span>
<span class="token comment">// 方法 (太长，懒.)</span>
chBindCur
chBindCurGet
chBindGet
chBindGetList
chExists
chGet
chLoad
chNew
chUnbind
chUnbindCur
chVarsClear
chVarsGet
chVarsNumGet
chVarsUpdateTime
loadGroupVars
loadPlayerGlobalVars
loadPlayerGroupVars<span class="token punctuation">,</span>notice
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ctx-group-的内容" tabindex="-1"><a class="header-anchor" href="#ctx-group-的内容" aria-hidden="true">#</a> <code>ctx.group</code> 的内容</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 成员</span>
active
groupId
guildId
groupName
cocRuleIndex
logCurName
logOn
recentDiceSendTime
showGroupWelcome
groupWelcomeMessage
enteredTime
inviteUserId
<span class="token comment">// 方法</span>
extActive
extClear
extGetActive
extInactive
extInactiveByName
getCharTemplate
isActive
playerGet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ctx-player-的内容" tabindex="-1"><a class="header-anchor" href="#ctx-player-的内容" aria-hidden="true">#</a> <code>ctx.player</code> 的内容</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 成员</span>
name
userId
lastCommandTime
autoSetNameTemplate
<span class="token comment">// 方法</span>
getValueNameByAlias
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ctx-endpoint-的内容" tabindex="-1"><a class="header-anchor" href="#ctx-endpoint-的内容" aria-hidden="true">#</a> <code>ctx.endPoint</code> 的内容</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 成员</span>
baseInfo
id
nickname
state
userId
groupNum
cmdExecutedNum
cmdExecutedLastTime
onlineTotalTime
platform
enable
<span class="token comment">// 方法</span>
adapterSetup
refreshGroupNum
setEnable
unmarshalYAML
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="msg-的内容" tabindex="-1"><a class="header-anchor" href="#msg-的内容" aria-hidden="true">#</a> <code>msg</code> 的内容</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 成员</span>
msg<span class="token punctuation">.</span>time <span class="token comment">// int64 发送时间</span>
msg<span class="token punctuation">.</span>messageType <span class="token comment">// string group 群聊 private 私聊</span>
msg<span class="token punctuation">.</span>groupId <span class="token comment">// string 如果是群聊，群号</span>
msg<span class="token punctuation">.</span>guildId <span class="token comment">// string 服务器群组号，会在 discord,kook,dodo 等平台见到</span>
msg<span class="token punctuation">.</span>sender <span class="token comment">// 发送者信息 (对象)</span>
    sender<span class="token punctuation">.</span>nickname
    sender<span class="token punctuation">.</span>userId
msg<span class="token punctuation">.</span>message
msg<span class="token punctuation">.</span>rawId <span class="token comment">// 原始信息 ID, 用于撤回等</span>
msg<span class="token punctuation">.</span>platform <span class="token comment">// 平台</span>
<span class="token comment">// 方法</span>
<span class="token comment">// (似乎目前没有？)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cmdargs-的内容" tabindex="-1"><a class="header-anchor" href="#cmdargs-的内容" aria-hidden="true">#</a> <code>cmdArgs</code> 的内容</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 成员</span>
<span class="token punctuation">.</span>command <span class="token comment">// string</span>
<span class="token punctuation">.</span>args <span class="token comment">// []string</span>
<span class="token punctuation">.</span>kwargs <span class="token comment">// []Kwarg</span>
<span class="token punctuation">.</span>at <span class="token comment">// []AtInfo</span>
<span class="token punctuation">.</span>rawArgs <span class="token comment">// string</span>
<span class="token punctuation">.</span>amIBeMentioned <span class="token comment">// bool (为何要加一个 Be?)</span>
<span class="token punctuation">.</span>cleanArgs <span class="token comment">// string 一种格式化后的参数，也就是中间所有分隔符都用一个空格替代</span>
<span class="token punctuation">.</span>specialExecuteTimes <span class="token comment">// 特殊的执行次数，对应 3# 这种</span>
<span class="token comment">// 方法</span>
<span class="token punctuation">.</span><span class="token function">isArgEqual</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> ss<span class="token operator">...</span><span class="token punctuation">)</span> <span class="token comment">// 返回 bool, 检查第 n 个参数是否在 ss 中</span>
<span class="token punctuation">.</span><span class="token function">eatPrefixWith</span><span class="token punctuation">(</span>ss<span class="token operator">...</span><span class="token punctuation">)</span> <span class="token comment">// 似乎是从 cleanArgs 中去除 ss 中第一个匹配的前缀</span>
<span class="token punctuation">.</span><span class="token function">chopPrefixToArgsWith</span><span class="token punctuation">(</span>ss<span class="token operator">...</span><span class="token punctuation">)</span> <span class="token comment">// 不懂</span>
<span class="token punctuation">.</span><span class="token function">getArgN</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// -&gt; string</span>
<span class="token punctuation">.</span><span class="token function">getKwarg</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token comment">// -&gt; Kwarg 如果有名为 str 的 flag，返回对象，否则返回 null/undefined(不确定)</span>
<span class="token punctuation">.</span><span class="token function">getRestArgsFrom</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// -&gt; string 获取从第 n 个参数之后的所有参数，用空格拼接成一个字符串</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><!----></div></footer><nav class="vp-page-nav"><a aria-label="编写牌堆" class="vp-link nav-link prev nav-link prev" href="/sealdice-manual-next/advanced/edit_deck.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->编写牌堆</div></a><a aria-label="编写新的 TRPG 规则" class="vp-link nav-link next nav-link next" href="/sealdice-manual-next/advanced/edit_gamesystem.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">编写新的 TRPG 规则<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/sealdice-manual-next/assets/app-8df52869.js" defer></script>
  </body>
</html>
